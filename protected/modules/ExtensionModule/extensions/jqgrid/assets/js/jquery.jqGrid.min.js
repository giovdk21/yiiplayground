/* 
* jqGrid  3.5-beta - jQuery Grid 
* Copyright (c) 2008, Tony Tomov, tony@trirand.com 
* Dual licensed under the MIT and GPL licenses 
* http://www.opensource.org/licenses/mit-license.php 
* http://www.gnu.org/licenses/gpl.html 
* Date:2009-05-24 build 2 
*/
(function($){$.fn.jqGrid=function(p){p=$.extend(true,{url:"",height:150,page:1,rowNum:20,records:0,pager:"",pgbuttons:true,pginput:true,colModel:[],rowList:[],colNames:[],sortorder:"asc",sortname:"",datatype:"xml",mtype:"GET",altRows:false,selarrrow:[],savedRow:[],shrinkToFit:true,xmlReader:{},jsonReader:{},subGrid:false,subGridModel:[],reccount:0,lastpage:0,lastsort:0,selrow:null,beforeSelectRow:null,onSelectRow:null,onSortCol:null,ondblClickRow:null,onRightClickRow:null,onPaging:null,onSelectAll:null,loadComplete:null,gridComplete:null,loadError:null,loadBeforeSend:null,afterInsertRow:null,beforeRequest:null,onHeaderClick:null,viewrecords:false,loadonce:false,multiselect:false,multikey:false,editurl:null,search:false,searchdata:{},caption:"",hidegrid:true,hiddengrid:false,postData:{},userData:{},treeGrid:false,treeGridModel:"nested",treeReader:{},treeANode:-1,ExpandColumn:null,tree_root_level:0,prmNames:{page:"page",rows:"rows",sort:"sidx",order:"sord"},forceFit:false,gridstate:"visible",cellEdit:false,cellsubmit:"remote",nv:0,loadui:"enable",toolbar:[false,""],scroll:false,multiboxonly:false,deselectAfterSort:true,scrollrows:false,autowidth:false,scrollOffset:18,cellLayout:5,subGridWidth:20,multiselectWidth:20,gridview:false,rownumWidth:25,rownumbers:false,pagerpos:"center",recordpos:"right"},$.jgrid.defaults,p||{});var grid={headers:[],cols:[],dragStart:function(i,x,y){this.resizing={idx:i,startX:x.clientX,sOL:y[0]};this.hDiv.style.cursor="col-resize";$(".ui-jqgrid-resize-mark","#gbox_"+p.id).css({visibility:"visible",left:y[0],top:y[1],height:y[2]})},dragMove:function(x){if(this.resizing){var diff=x.clientX-this.resizing.startX,h=this.headers[this.resizing.idx],newWidth=h.width+diff,hn,nWn;if(newWidth>25){$(".ui-jqgrid-resize-mark","#gbox_"+p.id).css({left:this.resizing.sOL+diff});if(p.forceFit===true){hn=this.headers[this.resizing.idx+p.nv];nWn=hn.width-diff;if(nWn>25){h.newWidth=newWidth;hn.newWidth=nWn;this.newWidth=p.tblwidth}}else{this.newWidth=p.tblwidth+diff;h.newWidth=newWidth}}}},dragEnd:function(){this.hDiv.style.cursor="default";if(this.resizing){var idx=this.resizing.idx,nw=this.headers[idx].newWidth||this.headers[idx].width;this.resizing=false;$(".ui-jqgrid-resize-mark").css("visibility","hidden");p.colModel[idx].width=nw;this.headers[idx].width=nw;this.headers[idx].el.style.width=nw+"px";if(this.cols.length>0){this.cols[idx].style.width=nw+"px"}if(p.forceFit===true){nw=this.headers[idx+p.nv].newWidth||this.headers[idx+p.nv].width;this.headers[idx+p.nv].width=nw;this.headers[idx+p.nv].el.style.width=nw+"px";if(this.cols.length>0){this.cols[idx+p.nv].style.width=nw+"px"}p.colModel[idx+p.nv].width=nw}else{p.tblwidth=this.newWidth;$("table:first",this.bDiv).css("width",p.tblwidth+"px");$("table:first",this.hDiv).css("width",p.tblwidth+"px");this.hDiv.scrollLeft=this.bDiv.scrollLeft}}},scrollGrid:function(){if(p.scroll===true){var scrollTop=this.bDiv.scrollTop;if(scrollTop!=this.scrollTop){this.scrollTop=scrollTop;if((this.bDiv.scrollHeight-scrollTop-$(this.bDiv).height())<=0){if(parseInt(p.page,10)+1<=parseInt(p.lastpage,10)){p.page=parseInt(p.page,10)+1;this.populate()}}}}this.hDiv.scrollLeft=this.bDiv.scrollLeft}};$.fn.getGridParam=function(pName){var $t=this[0];if(!$t.grid){return}if(!pName){return $t.p}else{return $t.p[pName]?$t.p[pName]:null}};$.fn.setGridParam=function(newParams){return this.each(function(){if(this.grid&&typeof(newParams)==="object"){$.extend(true,this.p,newParams)}})};$.fn.getDataIDs=function(){var ids=[];this.each(function(){$(this.rows).each(function(i){ids[i]=this.id})});return ids};$.fn.setSortName=function(newsort){return this.each(function(){var $t=this,i;for(i=0;i<$t.p.colModel.length;i++){if($t.p.colModel[i].name===newsort||$t.p.colModel[i].index===newsort){$("tr.ui-jqgrid-labels th:eq("+$t.p.lastsort+") div img",$t.grid.hDiv).remove();$t.p.lastsort=i;$t.p.sortname=newsort;break}}})};$.fn.setSelection=function(selection,onsr,sd){return this.each(function(){var $t=this,stat,pt,ind,olr,ner,ia,tpsr;onsr=onsr===false?false:true;if(selection===false){pt=sd}else{ind=$($t).getInd($t.rows,selection);pt=$($t.rows[ind])}selection=$(pt).attr("id");if(!pt.html()){return}if($t.p.selrow&&$t.p.scrollrows===true){olr=$($t).getInd($t.rows,$t.p.selrow);ner=$($t).getInd($t.rows,selection);if(ner>=0){if(ner>olr){scrGrid(ner,"d")}else{scrGrid(ner,"u")}}}if(!$t.p.multiselect){if($(pt).attr("class")!=="subgrid"){if($t.p.selrow){$("tr#"+$t.p.selrow.replace(".","\\."),$t.grid.bDiv).removeClass("ui-state-highlight").attr("aria-selected","false")}$t.p.selrow=selection;$(pt).addClass("ui-state-highlight").attr("aria-selected","true");if($t.p.onSelectRow&&onsr){$t.p.onSelectRow($t.p.selrow,true)}}}else{$t.p.selrow=selection;ia=$.inArray($t.p.selrow,$t.p.selarrrow);if(ia===-1){if($(pt).attr("class")!=="subgrid"){$(pt).addClass("ui-state-highlight").attr("aria-selected","true")}stat=true;$("#jqg_"+$t.p.selrow.replace(".","\\."),$t.rows).attr("checked",stat);$t.p.selarrrow.push($t.p.selrow);if($t.p.onSelectRow&&onsr){$t.p.onSelectRow($t.p.selrow,stat)}}else{if($(pt).attr("class")!=="subgrid"){$(pt).removeClass("ui-state-highlight").attr("aria-selected","false")}stat=false;$("#jqg_"+$t.p.selrow.replace(".","\\."),$t.rows).attr("checked",stat);$t.p.selarrrow.splice(ia,1);if($t.p.onSelectRow&&onsr){$t.p.onSelectRow($t.p.selrow,stat)}tpsr=$t.p.selarrrow[0];$t.p.selrow=(tpsr=="undefined")?null:tpsr}}function scrGrid(iR,tp){var ch=$($t.grid.bDiv)[0].clientHeight,st=$($t.grid.bDiv)[0].scrollTop,nROT=$t.rows[iR].offsetTop+$t.rows[iR].clientHeight,pROT=$t.rows[iR].offsetTop;if(tp=="d"){if(nROT>=ch){$($t.grid.bDiv)[0].scrollTop=st+nROT-pROT}}if(tp=="u"){if(pROT<st){$($t.grid.bDiv)[0].scrollTop=st-nROT+pROT}}}})};$.fn.resetSelection=function(){return this.each(function(){var t=this,ind;if(!t.p.multiselect){if(t.p.selrow){$("tr#"+t.p.selrow.replace(".","\\."),t.grid.bDiv).removeClass("ui-state-highlight");t.p.selrow=null}}else{$(t.p.selarrrow).each(function(i,n){ind=$(t).getInd(t.rows,n);$(t.rows[ind]).removeClass("ui-state-highlight");$("#jqg_"+n.replace(".","\\."),t.rows[ind]).attr("checked",false)});$("#cb_jqg",t.grid.hDiv).attr("checked",false);t.p.selarrrow=[]}t.p.savedRow=[]})};$.fn.getRowData=function(rowid){var res={};this.each(function(){var $t=this,nm,ind;ind=$($t).getInd($t.rows,rowid);if(ind===false){return res}$("td",$t.rows[ind]).each(function(i){nm=$t.p.colModel[i].name;if(nm!=="cb"&&nm!=="subgrid"){if($t.p.treeGrid===true&&nm==$t.p.ExpandColumn){res[nm]=$.htmlDecode($("span:first",this).html())}else{res[nm]=$.htmlDecode($(this).html())}}})});return res};$.fn.delRowData=function(rowid){var success=false,rowInd,ia;this.each(function(){var $t=this;rowInd=$($t).getInd($t.rows,rowid);if(rowInd===false){return false}else{$($t.rows[rowInd]).remove();$t.p.records--;$t.p.reccount--;$t.updatepager(true);success=true;if(rowid==$t.p.selrow){$t.p.selrow=null}ia=$.inArray(rowid,$t.p.selarrrow);if(ia!=-1){$t.p.selarrrow.splice(ia,1)}}if(rowInd==0&&success){this.updateColumns()}});return success};$.fn.setRowData=function(rowid,data){var nm,success=false;this.each(function(){var t=this,vl,ind;if(!t.grid){return false}if(data){ind=$(t).getInd(t.rows,rowid);if(ind===false){return false}success=true;$(this.p.colModel).each(function(i){nm=this.name;if(data[nm]!=undefined){vl=t.formatter(rowid,data[nm],i,data,"edit");if(t.p.treeGrid===true&&nm==t.p.ExpandColumn){$("td:eq("+i+") > span:first",t.rows[ind]).html(vl).attr("title",$.stripHtml(vl))}else{$("td:eq("+i+")",t.rows[ind]).html(vl).attr("title",$.stripHtml(vl))}success=true}})}});return success};$.fn.addRowData=function(rowid,data,pos,src){if(!pos){pos="last"}var success=false,nm,row,gi=0,si=0,ni=0,sind,i,v,prp="";if(data){this.each(function(){var t=this;row="<tr id='"+(rowid||t.p.records+1)+"' role='row' class='ui-widget-content jqgrow'>";if(t.p.rownumbers===true){prp=t.formatCol(ni,1);row+="<td role='gridcell' class='ui-state-default jqgrid-rownum' "+prp+">0</td>";ni=1}if(t.p.multiselect){v="<input type='checkbox' id='jqg_"+rowid+"' class='cbox'/>";prp=t.formatCol(ni,1);row+="<td role='gridcell' "+prp+">"+v+"</td>";gi=1}if(t.p.subGrid===true){row+=$(t).addSubGridCell(gi+ni,1);si=1}for(i=gi+si+ni;i<this.p.colModel.length;i++){nm=this.p.colModel[i].name;v=t.formatter(rowid,data[nm],i,data,"add");prp=t.formatCol(i,1);row+="<td role='gridcell' "+prp+" title='"+$.stripHtml(v)+"'>"+v+"</td>"}row+="</tr>";if(t.p.subGrid===true){row=$(row)[0];$(t).addSubGrid(row,gi)}if(t.rows.length===0){$("table:first",t.grid.bDiv).append(row)}else{switch(pos){case"last":$(t.rows[t.rows.length-1]).after(row);break;case"first":$(t.rows[0]).before(row);break;case"after":sind=$(t).getInd(t.rows,src);sind>=0?$(t.rows[sind]).after(row):"";break;case"before":sind=$(t).getInd(t.rows,src);sind>=0?$(t.rows[sind]).before(row):"";break}}t.p.records++;t.p.reccount++;if(pos==="first"||(pos==="before"&&sind===0)||t.rows.length===1){t.updateColumns()}try{t.p.afterInsertRow(rowid,data)}catch(e){}t.updatepager(true);success=true})}return success};$.fn.hideCol=function(colname){return this.each(function(){var $t=this,fndh=false;if(!$t.grid){return}if(typeof colname==="string"){colname=[colname]}$(this.p.colModel).each(function(i){if($.inArray(this.name,colname)!==-1&&!this.hidden){$("tr",$t.grid.hDiv).each(function(){$("th:eq("+i+")",this).css("display","none")});$($t.rows).each(function(j){$("td:eq("+i+")",$t.rows[j]).css({display:"none"})});$t.p.tblwidth-=this.width;this.hidden=true;fndh=true}});if(fndh===true){$("table:first",$t.grid.hDiv).width($t.p.tblwidth);$("table:first",$t.grid.bDiv).width($t.p.tblwidth);$t.grid.hDiv.scrollLeft=$t.grid.bDiv.scrollLeft}})};$.fn.showCol=function(colname){return this.each(function(){var $t=this,fdns=false;if(!$t.grid){return}if(typeof colname=="string"){colname=[colname]}$($t.p.colModel).each(function(i){if($.inArray(this.name,colname)!=-1&&this.hidden){$("tr",$t.grid.hDiv).each(function(){$("th:eq("+i+")",this).css("display","")});$($t.rows).each(function(j){$("td:eq("+i+")",$t.rows[j]).css("display","")});this.hidden=false;$t.p.tblwidth+=this.width;fdns=true}});if(fdns===true){$("table:first",$t.grid.hDiv).width($t.p.tblwidth);$("table:first",$t.grid.bDiv).width($t.p.tblwidth);$t.grid.hDiv.scrollLeft=$t.grid.bDiv.scrollLeft}})};$.fn.setGridWidth=function(nwidth,shrink){return this.each(function(){var $t=this,cw,initwidth=0,brd=$t.p.cellLayout,lvc,vc=0,isSafari,hs=false,scw=$t.p.scrollOffset,aw,gw=0,tw=0,msw=$t.p.multiselectWidth,sgw=$t.p.subGridWidth,rnw=$t.p.rownumWidth,cl=$t.p.cellLayout,cr;if(!$t.grid){return}if(typeof shrink!="boolean"){shrink=$t.p.shrinkToFit}if(isNaN(nwidth)){return}if(nwidth===grid.width){return}else{grid.width=$t.p.width=nwidth}$("#gbox_"+$t.p.id).css("width",nwidth+"px");$("#gview_"+$t.p.id).css("width",nwidth+"px");$($t.grid.bDiv).css("width",nwidth+"px");$($t.grid.hDiv).css("width",nwidth+"px");if($t.p.pager&&$($t.p.pager).hasClass("scroll")){$($t.p.pager).css("width",nwidth+"px")}if($t.p.toolbar[0]===true){$($t.grid.uDiv).css("width",nwidth+"px");if($t.p.toolbar[1]=="both"){$($t.grid.ubDiv).css("width",nwidth+"px")}}if(shrink===false&&$t.p.forceFit==true){$t.p.forceFit=false}if(shrink===true){$.each($t.p.colModel,function(i){if(this.hidden===false){initwidth+=parseInt(this.width,10);vc++}});isSafari=$.browser.safari?true:false;if(isSafari){brd=0;msw+=cl;sgw+=cl;rnw+=cl}if($t.p.multiselect){tw=msw;gw=msw+brd;vc--}if($t.p.subGrid){tw+=sgw;gw+=sgw+brd;vc--}if($t.p.rownumbers){tw+=rnw;gw+=rnw+brd;vc--}$t.p.tblwidth=initwidth;aw=nwidth-brd*vc-gw;if(!isNaN($t.p.height)){if($($t.grid.bDiv)[0].clientHeight<$($t.grid.bDiv)[0].scrollHeight){hs=true;aw-=scw}}initwidth=0;var cl=$t.grid.cols.length>0;$.each($t.p.colModel,function(i){var tn=this.name;if(this.hidden===false&&tn!=="cb"&&tn!=="subgrid"&&tn!=="rn"){cw=Math.floor((aw)/($t.p.tblwidth-tw)*this.width);this.width=cw;initwidth+=cw;$t.grid.headers[i].width=cw;$t.grid.headers[i].el.style.width=cw+"px";if(cl){$t.grid.cols[i].style.width=cw+"px"}lvc=i}});cr=0;if(hs&&nwidth-gw-(initwidth+brd*vc)!==scw){cr=nwidth-gw-(initwidth+brd*vc)-scw}else{if(Math.abs(nwidth-gw-(initwidth+brd*vc))!==1){cr=nwidth-gw-(initwidth+brd*vc)}}$t.p.colModel[lvc].width+=cr;cw=$t.p.colModel[lvc].width;$t.grid.headers[lvc].width=cw;$t.grid.headers[lvc].el.style.width=cw+"px";if(cl>0){$t.grid.cols[lvc].style.width=cw+"px"}$t.p.tblwidth=initwidth+tw+cr;$("table:first",$t.grid.bDiv).css("width",initwidth+tw+cr+"px");$("table:first",$t.grid.hDiv).css("width",initwidth+tw+cr+"px");$t.grid.hDiv.scrollLeft=$t.grid.bDiv.scrollLeft}})};$.fn.setGridHeight=function(nh){return this.each(function(){var $t=this;if(!$t.grid){return}$($t.grid.bDiv).css({height:nh+(isNaN(nh)?"":"px")});$t.p.height=nh})};$.fn.setCaption=function(newcap){return this.each(function(){this.p.caption=newcap;$("span.ui-jqgrid-title",this.grid.cDiv).html(newcap);$(this.grid.cDiv).show()})};$.fn.setLabel=function(colname,nData,prop,attrp){return this.each(function(){var $t=this,pos=-1;if(!$t.grid){return}if(isNaN(colname)){$($t.p.colModel).each(function(i){if(this.name==colname){pos=i;return false}})}else{pos=parseInt(colname,10)}if(pos>=0){var thecol=$("tr.ui-jqgrid-labels th:eq("+pos+")",$t.grid.hDiv);if(nData){$("div",thecol).html(nData)}if(prop){if(typeof prop==="string"){$(thecol).addClass(prop)}else{$(thecol).css(prop)}}if(typeof attrp==="object"){$(thecol).attr(attrp)}}})};$.fn.setCell=function(rowid,colname,nData,cssp,attrp){return this.each(function(){var $t=this,pos=-1,v;if(!$t.grid){return}if(isNaN(colname)){$($t.p.colModel).each(function(i){if(this.name==colname){pos=i;return false}})}else{pos=parseInt(colname,10)}if(pos>=0){var ind=$($t).getInd($t.rows,rowid);if(ind>=0){var tcell=$("td:eq("+pos+")",$t.rows[ind]);if(nData!==""){v=$t.formatter(rowid,nData,pos,$t.rows[ind],"edit");$(tcell).html(v).attr("title",$.stripHtml(v))}if(cssp){if(typeof cssp==="string"){$(tcell).addClass(cssp)}else{$(tcell).css(cssp)}}if(typeof attrp==="object"){$(tcell).attr(attrp)}}}})};$.fn.getCell=function(rowid,col){var ret=false;this.each(function(){var $t=this,pos=-1;if(!$t.grid){return}if(isNaN(col)){$($t.p.colModel).each(function(i){if(this.name===col){pos=i;return false}})}else{pos=parseInt(col,10)}if(pos>=0){var ind=$($t).getInd($t.rows,rowid);if(ind>=0){ret=$.htmlDecode($("td:eq("+pos+")",$t.rows[ind]).html())}}});return ret};$.fn.clearGridData=function(){return this.each(function(){var $t=this;if(!$t.grid){return}$("tbody:first tr",$t.grid.bDiv).remove();$t.p.selrow=null;$t.p.selarrrow=[];$t.p.savedRow=[];$t.p.records=0;$t.p.page="0";$t.p.lastpage="0";$t.p.reccount=0;$t.updatepager(true)})};$.fn.getInd=function(obj,rowid,rc){var ret=false,i=0,ol=obj.length;if(ol&&ol>0){while(i<ol){if(obj[i].id===rowid){ret=rc===true?obj[i]:i;break}i++}}return ret};$.htmlDecode=function(value){if(value=="&nbsp;"||value=="&#160;"||(value.length==1&&value.charCodeAt(0)==160)){return""}return !value?value:String(value).replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"')};$.jqgformat=function(format){var args=$.makeArray(arguments).slice(1);return format.replace(/\{(\d+)\}/g,function(m,i){return args[i]})};$.getAbsoluteIndex=function(t,rInd){var cntnotv=0,cntv=0,cell,i;for(i=0;i<t.cells.length;i++){cell=t.cells(i);if(cell.style.display=="none"){cntnotv++}else{cntv++}if(cntv>rInd){return i}}return i};$.stripHtml=function(v){var regexp=/<("[^"]*"|'[^']*'|[^'">])*>/gi;if(v){return v.replace(regexp,"")}else{return v}};$.stringToDoc=function(xmlString){var xmlDoc;if(typeof xmlString!=="string"){return xmlString}try{var parser=new DOMParser();xmlDoc=parser.parseFromString(xmlString,"text/xml")}catch(e){xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async=false;xmlDoc.loadXML(xmlString)}return(xmlDoc&&xmlDoc.documentElement&&xmlDoc.documentElement.tagName!="parsererror")?xmlDoc:null};$.parse=function(jsonString){var js=jsonString;if(js.substr(0,9)=="while(1);"){js=js.substr(9)}if(js.substr(0,2)=="/*"){js=js.substr(2,js.length-4)}with(window){return eval("("+js+")")}};return this.each(function(){if(this.grid){return}this.p=p;var i;if(this.p.colNames.length===0){for(i=0;i<this.p.colModel.length;i++){this.p.colNames[i]=this.p.colModel[i].label||this.p.colModel[i].name}}if(this.p.colNames.length!==this.p.colModel.length){alert($.jgrid.errors.model);return}var gv=$("<div class='ui-jqgrid-view'</div>"),ii,isMSIE=$.browser.msie?true:false,isSafari=$.browser.safari?true:false;$(gv).insertBefore(this);$(this).appendTo(gv).removeClass("scroll");var eg=$("<div class='ui-jqgrid ui-widget ui-widget-content ui-corner-all'></div>");$(eg).insertBefore(gv).attr("id","gbox_"+this.id);$(gv).appendTo(eg).attr("id","gview_"+this.id);if(isMSIE&&/6.0/.test(navigator.userAgent)){ii=$("<iframe src=\"javascript:false;document.write('');\"></iframe>").css({opacity:0})}else{ii=""}$("<div class='ui-widget-overlay jqgrid-overlay' id='lui_"+this.id+"'></div>").append(ii).insertBefore(gv);$("<div class='loading ui-state-default' id='load_"+this.id+"'>"+this.p.loadtext+"</div>").insertBefore(gv);$(this).attr({cellSpacing:"0",cellPadding:"0",border:"0",role:"grid","aria-multiselectable":this.p.multiselect,"aria-labelledby":"gbox_"+this.id});var ts=this,bSR=$.isFunction(this.p.beforeSelectRow)?this.p.beforeSelectRow:false,ondblClickRow=$.isFunction(this.p.ondblClickRow)?this.p.ondblClickRow:false,onSortCol=$.isFunction(this.p.onSortCol)?this.p.onSortCol:false,loadComplete=$.isFunction(this.p.loadComplete)?this.p.loadComplete:false,loadError=$.isFunction(this.p.loadError)?this.p.loadError:false,loadBeforeSend=$.isFunction(this.p.loadBeforeSend)?this.p.loadBeforeSend:false,onRightClickRow=$.isFunction(this.p.onRightClickRow)?this.p.onRightClickRow:false,afterInsRow=$.isFunction(this.p.afterInsertRow)?this.p.afterInsertRow:false,onHdCl=$.isFunction(this.p.onHeaderClick)?this.p.onHeaderClick:false,beReq=$.isFunction(this.p.beforeRequest)?this.p.beforeRequest:false,onSC=$.isFunction(this.p.onCellSelect)?this.p.onCellSelect:false,sortkeys=["shiftKey","altKey","ctrlKey"],IntNum=function(val,defval){val=parseInt(val,10);if(isNaN(val)){return defval?defval:0}else{return val}},formatCol=function(pos,rowInd){var ral=ts.p.colModel[pos].align,result="style='";if(ral){result+="text-align:"+ral+";"}if(ts.p.colModel[pos].hidden===true){result+="display:none;"}if(rowInd===0){result+="width: "+ts.grid.headers[pos].width+"px;"}return result+"'"},addCell=function(rowId,cell,pos,irow,srvr){var v,prp;v=formatter(rowId,cell,pos,srvr,"add");prp=formatCol(pos,irow);return"<td role='gridcell' "+prp+" title='"+$.stripHtml(v)+"'>"+v+"</td>"},formatter=function(rowId,cellval,colpos,rwdat,_act){var cm=ts.p.colModel[colpos],v;if(typeof cm.formatter!=="undefined"){var opts={rowId:rowId,colModel:cm};if($.isFunction(cm.formatter)){v=cm.formatter(cellval,opts,rwdat,_act)}else{if($.fmatter){v=$.fn.fmatter(cm.formatter,cellval,opts,rwdat,_act)}else{v=cellVal(cellval)}}}else{v=cellVal(cellval)}return v},cellVal=function(val){return val===undefined||val===null||val===""?"&#160;":val+""},addMulti=function(rowid,pos,irow){var v="<input type='checkbox' id='jqg_"+rowid+"' class='cbox' name='jqg_"+rowid+"'/>",prp=formatCol(pos,irow);return"<td role='gridcell' "+prp+">"+v+"</td>"},addRowNum=function(pos,irow,pG,rN){var v=(parseInt(pG)-1)*parseInt(rN)+1+irow,prp=formatCol(pos,irow);return"<td role='gridcell' class='ui-state-default jqgrid-rownum' "+prp+">"+v+"</td>"},reader=function(datatype){var field,f=[],j=0,i;for(i=0;i<ts.p.colModel.length;i++){field=ts.p.colModel[i];if(field.name!=="cb"&&field.name!=="subgrid"&&field.name!=="rn"){f[j]=(datatype=="xml")?field.xmlmap||field.name:field.jsonmap||field.name;j++}}return f},addXmlData=function(xml,t,rcnt){ts.p.reccount=0;if($.isXMLDoc(xml)){if(ts.p.treeANode===-1&&ts.p.scroll===false){$("tbody",t).empty();rcnt=0}else{rcnt=rcnt>0?rcnt:0}}else{return}var i,fpos,ir=0,v,row,gi=0,si=0,ni=0,idn,getId,f=[],rd={},rl=ts.rows.length,xmlr,rid,rowData=[],ari=0;if(!ts.p.xmlReader.repeatitems){f=reader("xml")}if(ts.p.keyIndex===false){idn=ts.p.xmlReader.id;if(idn.indexOf("[")===-1){getId=function(trow,k){return $(idn,trow).text()||k}}else{getId=function(trow,k){return trow.getAttribute(idn.replace(/[\[\]]/g,""))||k}}}else{getId=function(trow){return(f.length-1>=ts.p.keyIndex)?$(f[ts.p.keyIndex],trow).text():$(ts.p.xmlReader.cell+":eq("+ts.p.keyIndex+")",trow).text()}}$(ts.p.xmlReader.page,xml).each(function(){ts.p.page=this.textContent||this.text||1});$(ts.p.xmlReader.total,xml).each(function(){ts.p.lastpage=this.textContent||this.text||1});$(ts.p.xmlReader.records,xml).each(function(){ts.p.records=this.textContent||this.text||0});$(ts.p.xmlReader.userdata,xml).each(function(){ts.p.userData[this.getAttribute("name")]=this.textContent||this.text});var gxml=$(ts.p.xmlReader.root+" "+ts.p.xmlReader.row,xml),gl=gxml.length,j=0;if(gxml&&gl){var rn=ts.p.rowNum;while(j<gl){xmlr=gxml[j];rid=getId(xmlr,j+1);rowData[ari++]="<tr id='"+rid+"' role='row' class ='ui-widget-content jqgrow'>";if(ts.p.rownumbers===true){rowData[ari++]=addRowNum(0,j,ts.p.page,ts.p.rowNum);ni=1}if(ts.p.multiselect===true){rowData[ari++]=addMulti(rid,ni,j);gi=1}if(ts.p.subGrid===true){rowData[ari++]=$(ts).addSubGridCell(gi+ni,j+rcnt);si=1}if(ts.p.xmlReader.repeatitems===true){$(ts.p.xmlReader.cell,xmlr).each(function(k){v=this.textContent||this.text;rd[ts.p.colModel[k+gi+si+ni].name]=v;rowData[ari++]=addCell(rid,v,k+gi+si+ni,j+rcnt,xmlr)})}else{for(i=0;i<f.length;i++){v=$(f[i],xmlr).text();rd[ts.p.colModel[i+gi+si+ni].name]=v;rowData[ari++]=addCell(rid,v,i+gi+si+ni,j+rcnt,xmlr)}}rowData[ari++]="</tr>";if(ts.p.gridview===false){if(ts.p.treeGrid===true){fpos=ts.p.treeANode>=-1?ts.p.treeANode:0;row=$(rowData.join(""))[0];try{$(ts).setTreeNode(rd,row)}catch(e){}rl===0?$("tbody:first",t).append(row):$(ts.rows[j+fpos+rcnt]).after(row)}else{$("tbody:first",t).append(rowData.join(""))}if(ts.p.subGrid===true){try{$(ts).addSubGrid(ts.rows[ts.rows.length-1],gi)}catch(e){}}if(afterInsRow){ts.p.afterInsertRow(rid,rd,this)}rowData=[];ari=0}rd={};ir++;j++;if(ir>=rn){break}}}if(ts.p.gridview===true){$("table:first",t).append(rowData.join(""))}if(ir>0){ts.grid.cols=ts.rows[0].cells;if(ts.p.records===0){ts.p.records=gl}}rowData=null;if(!ts.p.treeGrid&&!ts.p.scroll){ts.grid.bDiv.scrollTop=0;ts.p.reccount=ir}ts.p.treeANode=-1;endReq();updatepager(false)},addJSONData=function(data,t,rcnt){ts.p.reccount=0;if(data){if(ts.p.treeANode===-1&&ts.p.scroll===false){$("tbody",t).empty();rcnt=0}else{rcnt=rcnt>0?rcnt:0}}else{return}var ir=0,v,i,j,row,f=[],cur,gi=0,si=0,ni=0,len,drows,idn,rd={},fpos,rl=ts.rows.length,idr,rowData=[],ari=0;ts.p.page=data[ts.p.jsonReader.page]||1;ts.p.lastpage=data[ts.p.jsonReader.total]||1;ts.p.records=data[ts.p.jsonReader.records]||0;ts.p.userData=data[ts.p.jsonReader.userdata]||{};if(!ts.p.jsonReader.repeatitems){f=reader("json")}if(ts.p.keyIndex===false){idn=ts.p.jsonReader.id;if(f.length>0&&!isNaN(idn)){idn=f[idn]}}else{idn=f.length>0?f[ts.p.keyIndex]:ts.p.keyIndex}drows=data[ts.p.jsonReader.root];if(drows){len=drows.length,i=0;var rn=ts.p.rowNum;while(i<len){cur=drows[i];idr=cur[idn];if(idr===undefined){if(f.length===0){if(ts.p.jsonReader.cell){var ccur=cur[ts.p.jsonReader.cell];idr=ccur[idn]||i+1;ccur=null}else{idr=i+1}}else{idr=i+1}}rowData[ari++]="<tr id='"+idr+"' role='row' class= 'ui-widget-content jqgrow'>";if(ts.p.rownumbers===true){rowData[ari++]=addRowNum(0,i,ts.p.page,ts.p.rowNum);ni=1}if(ts.p.multiselect){rowData[ari++]=addMulti(idr,ni,i);gi=1}if(ts.p.subGrid){rowData[ari++]=$(ts).addSubGridCell(gi+ni,i+rcnt);si=1}if(ts.p.jsonReader.repeatitems===true){if(ts.p.jsonReader.cell){cur=cur[ts.p.jsonReader.cell]}for(j=0;j<cur.length;j++){rowData[ari++]=addCell(idr,cur[j],j+gi+si+ni,i+rcnt,cur);rd[ts.p.colModel[j+gi+si+ni].name]=cur[j]}}else{for(j=0;j<f.length;j++){v=cur[f[j]];if(v===undefined){try{v=eval("cur."+f[j])}catch(e){}}rowData[ari++]=addCell(idr,v,j+gi+si+ni,i+rcnt,cur);rd[ts.p.colModel[j+gi+si+ni].name]=cur[f[j]]}}rowData[ari++]="</tr>";if(ts.p.gridview===false){if(ts.p.treeGrid===true){fpos=ts.p.treeANode>=-1?ts.p.treeANode:0;row=$(rowData.join(""))[0];try{$(ts).setTreeNode(rd,row)}catch(e){}rl===0?$("tbody:first",t).append(row):$(ts.rows[i+fpos+rcnt]).after(row)}else{$("tbody:first",t).append(rowData.join(""))}if(ts.p.subGrid===true){try{$(ts).addSubGrid(ts.rows[ts.rows.length-1],gi)}catch(e){}}if(afterInsRow){ts.p.afterInsertRow(idr,rd,drows[i])}rowData=[];ari=0}rd={};ir++;i++;if(ir>rn){break}}if(ts.p.gridview===true){$("table:first",t).append(rowData.join(""))}if(ir>0){ts.grid.cols=ts.rows[0].cells;if(ts.p.records===0){ts.p.records=len}}}if(!ts.p.treeGrid&&!ts.p.scroll){ts.grid.bDiv.scrollTop=0}ts.p.reccount=ir;ts.p.treeANode=-1;endReq();updatepager(false)},updatepager=function(rn){var cp,last,base,bs,from,to,tot,fmt;base=(parseInt(ts.p.page)-1)*parseInt(ts.p.rowNum);if(ts.p.pager){if(ts.p.loadonce){cp=last=1;ts.p.lastpage=ts.page=1;$(".selbox",ts.p.pager).attr("disabled",true)}else{cp=IntNum(ts.p.page);last=IntNum(ts.p.lastpage);$(".selbox",ts.p.pager).attr("disabled",false)}if(ts.p.pginput===true){$(".ui-pg-input",ts.p.pager).val(ts.p.page);$("#sp_1",ts.p.pager).html(ts.p.lastpage)}if(ts.p.viewrecords){bs=ts.p.scroll===true?0:base;if(ts.p.reccount===0){$(".ui-paging-info",ts.p.pager).html(ts.p.emptyrecords)}else{from=bs+1;to=base+ts.p.reccount;tot=ts.p.records;if($.fmatter){fmt=$.jgrid.formatter.integer||{};from=$.fmatter.util.NumberFormat(from,fmt);to=$.fmatter.util.NumberFormat(to,fmt);tot=$.fmatter.util.NumberFormat(tot,fmt)}$(".ui-paging-info",ts.p.pager).html($.jqgformat(ts.p.recordtext,from,to,tot))}}if(ts.p.pgbuttons===true){if(cp<=0){cp=last=1}if(cp==1){$("#first, #prev",ts.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover")}else{$("#first, #prev",ts.p.pager).removeClass("ui-state-disabled")}if(cp==last){$("#next, #last",ts.p.pager).addClass("ui-state-disabled").removeClass("ui-state-hover")}else{$("#next, #last",ts.p.pager).removeClass("ui-state-disabled")}}}if(rn===true&&ts.p.rownumbers===true){$("td.jqgrid-rownum",ts.rows).each(function(i){$(this).html(base+1+i)})}if($.isFunction(ts.p.gridComplete)){ts.p.gridComplete()}},populate=function(){if(!grid.hDiv.loading){var gdata,prm={nd:(new Date().getTime()),_search:ts.p.search},dt,dstr;prm[ts.p.prmNames.rows]=ts.p.rowNum;prm[ts.p.prmNames.page]=ts.p.page;prm[ts.p.prmNames.sort]=ts.p.sortname;prm[ts.p.prmNames.order]=ts.p.sortorder;gdata=$.extend(ts.p.postData,prm);gdata=$.extend(gdata,ts.p.searchdata||{});var rcnt=ts.p.scroll===false?0:ts.rows.length-1;if($.isFunction(ts.p.datatype)){ts.p.datatype(gdata,"load_"+ts.p.id)}else{beginReq()}dt=ts.p.datatype.toLowerCase();switch(dt){case"json":case"xml":case"script":$.ajax({url:ts.p.url,type:ts.p.mtype,dataType:dt=="json"?"text":dt,data:gdata,complete:function(req,st){if(st=="success"){if(dt==="json"||dt==="script"){addJSONData($.parse(req.responseText),ts.grid.bDiv,rcnt)}if(dt==="xml"){addXmlData(req.responseXML,ts.grid.bDiv,rcnt)}if(loadComplete){loadComplete(req)}req=null}},error:function(xhr,st,err){if(loadError){loadError(xhr,st,err)}endReq();xhr=null},beforeSend:function(xhr){if(loadBeforeSend){loadBeforeSend(xhr)}xhr=null}});if(ts.p.loadonce||ts.p.treeGrid){ts.p.datatype="local"}break;case"xmlstring":addXmlData(dstr=$.stringToDoc(ts.p.datastr),ts.grid.bDiv);ts.p.datatype="local";if(loadComplete){loadComplete(dstr)}ts.p.datastr=null;break;case"jsonstring":if(typeof ts.p.datastr=="string"){dstr=$.parse(ts.p.datastr)}else{dstr=ts.p.datastr}addJSONData(dstr,ts.grid.bDiv);ts.p.datatype="local";if(loadComplete){loadComplete(dstr)}ts.p.datastr=null;break;case"local":case"clientside":ts.p.datatype="local";sortArrayData();break}}},beginReq=function(){if(beReq){ts.p.beforeRequest()}grid.hDiv.loading=true;if(ts.p.hiddengrid){return}switch(ts.p.loadui){case"disable":break;case"enable":$("#load_"+ts.p.id).show();break;case"block":$("#lui_"+ts.p.id).show();$("#load_"+ts.p.id).show();break}},endReq=function(){grid.hDiv.loading=false;switch(ts.p.loadui){case"disable":break;case"enable":$("#load_"+ts.p.id).hide();break;case"block":$("#lui_"+ts.id).hide();$("#load_"+ts.p.id).hide();break}},sortArrayData=function(){var stripNum=/[\$,%]/g;var rows=[],col=0,st,sv,findSortKey,newDir=(ts.p.sortorder=="asc")?1:-1;$.each(ts.p.colModel,function(i,v){if(this.index==ts.p.sortname||this.name==ts.p.sortname){col=ts.p.lastsort=i;st=this.sorttype;return false}});if(st=="float"||st=="number"||st=="currency"){findSortKey=function($cell){var key=parseFloat($cell.replace(stripNum,""));return isNaN(key)?0:key}}else{if(st=="int"||st=="integer"){findSortKey=function($cell){return IntNum($cell.replace(stripNum,""))}}else{if(st=="date"){findSortKey=function($cell){var fd=ts.p.colModel[col].datefmt||"Y-m-d";return parseDate(fd,$cell).getTime()}}else{findSortKey=function($cell){return $.trim($cell.toUpperCase())}}}}$.each(ts.rows,function(index,row){try{sv=$.unformat($(row).children("td").eq(col),{colModel:ts.p.colModel[col]},col,true)}catch(_){sv=$(row).children("td").eq(col).text()}row.sortKey=findSortKey(sv);rows[index]=this});if(ts.p.treeGrid){$(ts).SortTree(newDir)}else{rows.sort(function(a,b){if(a.sortKey<b.sortKey){return -newDir}if(a.sortKey>b.sortKey){return newDir}return 0});if(rows[0]){$("td",rows[0]).each(function(k){$(this).css("width",grid.headers[k].width+"px")});grid.cols=rows[0].cells}$.each(rows,function(index,row){$("tbody",ts.grid.bDiv).append(row);row.sortKey=null})}if(ts.p.multiselect){$("tbody tr",ts.grid.bDiv).removeClass("ui-state-highlight");$("[id^=jqg_]",ts.rows).attr("checked",false);$("#cb_jqg",ts.grid.hDiv).attr("checked",false);ts.p.selarrrow=[]}ts.grid.bDiv.scrollTop=0;endReq()},parseDate=function(format,date){var tsp={m:1,d:1,y:1970,h:0,i:0,s:0},i;format=format.toLowerCase();date=date.split(/[\\\/:_;.\s-]/);format=format.split(/[\\\/:_;.\s-]/);for(i=0;i<format.length;i++){tsp[format[i]]=IntNum(date[i],tsp[format[i]])}tsp.m=parseInt(tsp.m,10)-1;var ty=tsp.y;if(ty>=70&&ty<=99){tsp.y=1900+tsp.y}else{if(ty>=0&&ty<=69){tsp.y=2000+tsp.y}}return new Date(tsp.y,tsp.m,tsp.d,tsp.h,tsp.i,tsp.s,0)},setPager=function(){var sep="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",pgid=$(ts.p.pager).attr("id")||"pager",pginp=(ts.p.pginput===true)?"<td>"+$.jqgformat(ts.p.pgtext||"","<input class='ui-pg-input' type='text' size='2' maxlength='7' value='0' role='textbox'/>","<span id='sp_1'></span>")+"</td>":"",pgl="<table cellspacing='0' cellpadding='0' border='0' style='table-layout:auto;' class='ui-pg-table'><tbody><tr>",str,pgcnt,lft,cent,rgt,twd,tdw,i,clearVals=function(onpaging){if($.isFunction(ts.p.onPaging)){ts.p.onPaging(onpaging)}ts.p.selrow=null;if(ts.p.multiselect){ts.p.selarrrow=[];$("#cb_jqg",ts.grid.hDiv).attr("checked",false)}ts.p.savedRow=[]};pgcnt="pg_"+pgid;lft=pgid+"_left";cent=pgid+"_center";rgt=pgid+"_right";$(ts.p.pager).addClass("ui-jqgrid-pager corner-bottom").append("<div id='"+pgcnt+"' class='ui-pager-control' role='group'><table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table' style='width:100%;table-layout:fixed;' role='row'><tbody><tr><td id='"+lft+"' align='left'></td><td id='"+cent+"' align='center' style='white-space:nowrap;'></td><td id='"+rgt+"' align='right'></td></tr></tbody></table></div>");if(ts.p.pgbuttons===true){pgl+="<td id='first' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-first'></span></td>";pgl+="<td id='prev' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-prev'></span></td>";pgl+=pginp!=""?sep+pginp+sep:"";pgl+="<td id='next' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-next'></span></td>";pgl+="<td id='last' class='ui-pg-button ui-corner-all'><span class='ui-icon ui-icon-seek-end'></span></td>"}else{if(pginp!=""){pgl+=pginp}}if(ts.p.rowList.length>0){str="<select class='ui-pg-selbox' role='listbox'>";for(i=0;i<ts.p.rowList.length;i++){str+="<option role='option' value="+ts.p.rowList[i]+((ts.p.rowNum==ts.p.rowList[i])?" selected":"")+">"+ts.p.rowList[i]}str+="</select>";pgl+="<td>"+str+"</td>"}pgl+="</tr></tbody></table>";if(ts.p.viewrecords===true){$("td#"+pgid+"_"+ts.p.recordpos,"#"+pgcnt).append("<div class='ui-paging-info'></div>")}$("td#"+pgid+"_"+ts.p.pagerpos,"#"+pgcnt).append(pgl);tdw=$(".ui-jqgrid").css("font-size")||"11px";$("body").append("<div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+tdw+";visibility:hidden;' ></div>");twd=$(pgl).clone(false).appendTo("#testpg").width();$("#testpg").remove();if(twd>0){twd+=25;$("td#"+pgid+"_"+ts.p.pagerpos,"#"+pgcnt).width(twd)}ts.p._nvtd=[];ts.p._nvtd[0]=twd?Math.floor((ts.p.width-twd)/2):Math.floor(ts.p.width/3);ts.p._nvtd[1]=0;pgl=null;$(".ui-pg-selbox","#"+pgcnt).bind("change",function(){ts.p.rowNum=this.value;clearVals("records");populate();return false});if(ts.p.pgbuttons===true){$(".ui-pg-button","#"+pgcnt).hover(function(e){if($(this).hasClass("ui-state-disabled")){this.style.cursor="default"}else{$(this).addClass("ui-state-hover");this.style.cursor="pointer"}},function(e){if($(this).hasClass("ui-state-disabled")){}else{$(this).removeClass("ui-state-hover");this.style.cursor="default"}});$("#first, #prev, #next, #last",ts.p.pager).click(function(e){var cp=IntNum(ts.p.page),last=IntNum(ts.p.lastpage),selclick=false,fp=true,pp=true,np=true,lp=true;if(last===0||last===1){fp=false;pp=false;np=false;lp=false}else{if(last>1&&cp>=1){if(cp===1){fp=false;pp=false}else{if(cp>1&&cp<last){}else{if(cp===last){np=false;lp=false}}}}else{if(last>1&&cp===0){np=false;lp=false;cp=last-1}}}if(this.id==="first"&&fp){ts.p.page=1;selclick=true}if(this.id==="prev"&&pp){ts.p.page=(cp-1);selclick=true}if(this.id==="next"&&np){ts.p.page=(cp+1);selclick=true}if(this.id==="last"&&lp){ts.p.page=last;selclick=true}if(selclick){clearVals(this.id);populate()}e.stopPropagation();return false})}if(ts.p.pginput===true){$("input.ui-pg-input","#"+pgcnt).keypress(function(e){var key=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(key==13){ts.p.page=($(this).val()>0)?$(this).val():ts.p.page;clearVals("user");populate();return false}return this})}},sortData=function(index,idxcol,reload){var imgs,so,scg,ls,iId;if(ts.p.savedRow.length>0){return}if(!reload){if(ts.p.lastsort===idxcol){if(ts.p.sortorder==="asc"){ts.p.sortorder="desc"}else{if(ts.p.sortorder==="desc"){ts.p.sortorder="asc"}}}else{ts.p.sortorder="asc"}ts.p.page=1}imgs=(ts.p.sortorder==="asc")?"ui-icon-triangle-1-n":"ui-icon-triangle-1-s";imgs="<span class='ui-icon ui-grid-ico-sort "+imgs+"'>&nbsp;&nbsp;&nbsp;&nbsp;</span>";var thd=$("thead:first",grid.hDiv).get(0);ls=ts.p.colModel[ts.p.lastsort].name.replace(".","\\.");$("tr th div#jqgh_"+ls+" span.ui-grid-ico-sort",thd).remove();$("tr th:eq("+ts.p.lastsort+")",thd).attr("aria-selected","false");iId=index.replace(".","\\.");$("tr th div#"+iId,thd).append(imgs);$("tr th:eq("+idxcol+")",thd).attr("aria-selected","true");ts.p.lastsort=idxcol;index=index.substring(5);ts.p.sortname=ts.p.colModel[idxcol].index||index;so=ts.p.sortorder;if(onSortCol){onSortCol(index,idxcol,so)}if(ts.p.datatype=="local"){if(ts.p.deselectAfterSort){$(ts).resetSelection()}}else{ts.p.selrow=null;if(ts.p.multiselect){$("#cb_jqg",ts.grid.hDiv).attr("checked",false)}ts.p.selarrrow=[];ts.p.savedRow=[]}scg=ts.p.scroll;if(ts.p.scroll===true){ts.p.scroll=false}if(ts.p.subGrid&&ts.p.datatype=="local"){$("td.sgexpanded","#"+ts.p.id).each(function(){$(this).trigger("click")})}populate();if(ts.p.sortname!=index&&idxcol){ts.p.lastsort=idxcol}setTimeout(function(){ts.p.scroll=scg},500)},setColWidth=function(){var initwidth=0,brd=ts.p.cellLayout,vc=0,lvc,scw=ts.p.scrollOffset,cw,hs=false,aw,tw=0,gw=0,msw=ts.p.multiselectWidth,sgw=ts.p.subGridWidth,rnw=ts.p.rownumWidth,cl=ts.p.cellLayout,cr;$.each(ts.p.colModel,function(i){if(typeof this.hidden==="undefined"){this.hidden=false}if(this.hidden===false){initwidth+=IntNum(this.width);vc++}});if(isNaN(ts.p.width)){ts.p.width=grid.width=initwidth}else{grid.width=ts.p.width}ts.p.tblwidth=initwidth;if(ts.p.shrinkToFit===false&&ts.p.forceFit===true){ts.p.forceFit=false}if(ts.p.shrinkToFit===true){if(isSafari){brd=0;msw+=cl;sgw+=cl;rnw+=cl}if(ts.p.multiselect){tw=msw;gw=msw+brd;vc--}if(ts.p.subGrid){tw+=sgw;gw+=sgw+brd;vc--}if(ts.p.rownumbers){tw+=rnw;gw+=rnw+brd;vc--}aw=grid.width-brd*vc-gw;if(isNaN(ts.p.height)){}else{aw-=scw;hs=true}initwidth=0;$.each(ts.p.colModel,function(i){if(this.hidden===false&&this.name!=="cb"&&this.name!=="subgrid"&&this.name!=="rn"){cw=Math.floor(aw/(ts.p.tblwidth-tw)*this.width);this.width=cw;initwidth+=cw;lvc=i}});cr=0;if(hs&&grid.width-gw-(initwidth+brd*vc)!==scw){cr=grid.width-gw-(initwidth+brd*vc)-scw}else{if(!hs&&Math.abs(grid.width-gw-(initwidth+brd*vc))!==1){cr=grid.width-gw-(initwidth+brd*vc)}}ts.p.colModel[lvc].width+=cr;ts.p.tblwidth=initwidth+tw+cr}},nextVisible=function(iCol){var ret=iCol,j=iCol,i;for(i=iCol+1;i<ts.p.colModel.length;i++){if(ts.p.colModel[i].hidden!==true){j=i;break}}return j-ret},getOffset=function(iCol){var i,ret={},brd1=isSafari?0:5;ret[0]=ret[1]=ret[2]=0;for(i=0;i<=iCol;i++){if(ts.p.colModel[i].hidden===false){ret[0]+=ts.p.colModel[i].width+brd1}}ret[0]=ret[0]-ts.grid.bDiv.scrollLeft;if($(ts.grid.cDiv+":visible")){ret[1]+=$(ts.grid.cDiv).height()+parseInt($(ts.grid.cDiv).css("padding-top"))+parseInt($(ts.grid.cDiv).css("padding-bottom"))}if(ts.p.toolbar[0]==true&&(ts.p.toolbar[1]=="top"||ts.p.toolbar[1]=="both")){ret[1]+=$(ts.grid.uDiv).height()+parseInt($(ts.grid.uDiv).css("border-top-width"))+parseInt($(ts.grid.uDiv).css("border-bottom-width"))}ret[2]+=$(ts.grid.bDiv).height()+$(ts.grid.hDiv).height();return ret};this.p.id=this.id;if($.inArray(ts.p.multikey,sortkeys)==-1){ts.p.multikey=false}if(this.p.treeGrid===true){this.p.subGrid=false;this.p.altRows=false;this.p.pgbuttons=false;this.p.pginput=false;this.p.multiselect=false;this.p.rowList=[];try{$(this).setTreeGrid();this.p.treedatatype=this.p.datatype;$.each(this.p.treeReader,function(i,n){if(n){ts.p.colNames.push(n);ts.p.colModel.push({name:n,width:1,hidden:true,sortable:false,resizable:false,hidedlg:true,editable:true,search:false})}})}catch(_){}}ts.p.keyIndex=false;for(i=0;i<ts.p.colModel.length;i++){if(ts.p.colModel[i].key===true){ts.p.keyIndex=i;break}}if(this.p.subGrid){this.p.colNames.unshift("");this.p.colModel.unshift({name:"subgrid",width:isSafari?ts.p.subGridWidth+ts.p.cellLayout:ts.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false});var cm=this.p.subGridModel;if(cm[0]){cm[0].align=$.extend([],cm[0].align||[]);for(i=0;i<cm[0].name.length;i++){cm[0].align[i]=cm[0].align[i]||"left"}}cm=null}if(this.p.multiselect){this.p.colNames.unshift("<input id='cb_jqg' class='cbox' type='checkbox'/>");this.p.colModel.unshift({name:"cb",width:isSafari?ts.p.multiselectWidth+ts.p.cellLayout:ts.p.multiselectWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center"})}if(this.p.rownumbers){this.p.colNames.unshift("");this.p.colModel.unshift({name:"rn",width:ts.p.rownumWidth,sortable:false,resizable:false,hidedlg:true,search:false,align:"center"})}var xReader={root:"rows",row:"row",page:"rows>page",total:"rows>total",records:"rows>records",repeatitems:true,cell:"cell",id:"[id]",userdata:"userdata",subgrid:{root:"rows",row:"row",repeatitems:true,cell:"cell"}},jReader={root:"rows",page:"page",total:"total",records:"records",repeatitems:true,cell:"cell",id:"id",userdata:"userdata",subgrid:{root:"rows",repeatitems:true,cell:"cell"}};if(ts.p.scroll===true){ts.p.pgbuttons=false;ts.p.pginput=false;ts.p.rowList=[]}ts.p.xmlReader=$.extend(xReader,ts.p.xmlReader);ts.p.jsonReader=$.extend(jReader,ts.p.jsonReader);var thead="<thead><tr class='ui-jqgrid-labels' role='rowheader'>",tdc,idn,w,res,sort,td,ptr,tbody;if(ts.p.shrinkToFit===true&&ts.p.forceFit===true){for(i=ts.p.colModel.length-1;i>=0;i--){if(!ts.p.colModel[i].hidden){ts.p.colModel[i].resizable=false;break}}}tdc=isMSIE?"class='ui-th-div-ie'":"";for(i=0;i<this.p.colNames.length;i++){thead+="<th role='columnheader' class='ui-state-default ui-th-column'>";idn=ts.p.colModel[i].name;thead+="<div id='jqgh_"+idn+"' "+tdc+">"+ts.p.colNames[i]+"&nbsp;";if(idn==ts.p.sortname){var imgs=(ts.p.sortorder==="asc")?"ui-icon-triangle-1-n":" ui-icon-triangle-1-s";imgs="<span class='ui-icon ui-grid-ico-sort "+imgs+"'>&nbsp;&nbsp;&nbsp;&nbsp;</span>";thead+=imgs;ts.p.lastsort=i}thead+="</div></th>"}thead+="</tr></thead>";$(this).append(thead);$("thead tr:first th",this).hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")});if(this.p.multiselect){var onSA=true,emp=[],chk;if(typeof ts.p.onSelectAll!=="function"){onSA=false}$("#cb_jqg",this).bind("click",function(){if(this.checked){$("[id^=jqg_]",ts.rows).attr("checked",true);$(ts.rows).each(function(i){if(!$(this).hasClass("subgrid")){$(this).addClass("ui-state-highlight").attr("aria-selected","true");ts.p.selarrrow[i]=ts.p.selrow=this.id}});chk=true;emp=[]}else{$("[id^=jqg_]",ts.rows).attr("checked",false);$(ts.rows).each(function(i){if(!$(this).hasClass("subgrid")){$(this).removeClass("ui-state-highlight").attr("aria-selected","false");emp[i]=this.id}});ts.p.selarrrow=[];ts.p.selrow=null;chk=false}if(onSA){ts.p.onSelectAll(chk?ts.p.selarrrow:emp,chk)}})}$.each(ts.p.colModel,function(i){if(!this.width){this.width=150}});if(ts.p.autowidth===true){var pw=$(eg).innerWidth();ts.p.width=pw>0?pw:"nw"}setColWidth();$(eg).css("width",grid.width+"px").append("<div class='ui-jqgrid-resize-mark'>&nbsp;</div>");$(gv).css("width",grid.width+"px");thead=$("thead:first",ts).get(0);$("tr:first th",thead).each(function(j){w=ts.p.colModel[j].width;if(typeof ts.p.colModel[j].resizable==="undefined"){ts.p.colModel[j].resizable=true}res=document.createElement("span");$(res).html("&#160;");if(ts.p.colModel[j].resizable){$(this).addClass(ts.p.resizeclass);$(res).mousedown(function(e){if(ts.p.forceFit===true){ts.p.nv=nextVisible(j)}grid.dragStart(j,e,getOffset(j));e.preventDefault();return false}).addClass("ui-jqgrid-resize")}else{res=""}$(this).css("width",w+"px").prepend(res);if(ts.p.colModel[j].hidden){$(this).css("display","none")}grid.headers[j]={width:w,el:this};sort=ts.p.colModel[j].sortable;if(typeof sort!=="boolean"){sort=true}if(sort){$("div",this).addClass("ui-jqgrid-sortable").click(function(){sortData(this.id,j);return false})}});tbody=document.createElement("tbody");this.appendChild(tbody);$(this).addClass("ui-jqgrid-btable");grid.hTable=document.createElement("table");$(grid.hTable).append(thead).css({width:ts.p.tblwidth+"px"}).attr({cellSpacing:"0",cellPadding:"0",border:"0",role:"grid","aria-labelledby":"gbox_"+this.id}).addClass("ui-jqgrid-htable");grid.hDiv=document.createElement("div");var hg=(ts.p.caption&&ts.p.hiddengrid===true)?true:false;var hb=$("<div class='ui-jqgrid-hbox'></div>");$(grid.hDiv).css({width:grid.width+"px"}).addClass("ui-state-default ui-jqgrid-hdiv").append(hb).bind("selectstart",function(){return false});$(hb).append(grid.hTable);if(hg){$(grid.hDiv).hide();ts.p.gridstate="hidden"}ts.p._height=0;if(ts.p.pager){if(typeof ts.p.pager=="string"){if(ts.p.pager.substr(0,1)!="#"){ts.p.pager="#"+ts.p.pager}}if($(ts.p.pager).hasClass("scroll")){$(ts.p.pager).css({width:grid.width+"px"}).show();$(ts.p.pager).appendTo(eg).addClass("ui-state-default ui-jqgrid-pager");ts.p._height+=parseInt($(ts.p.pager).height(),10);if(hg){$(ts.p.pager).hide()}}setPager()}if(ts.p.cellEdit===false){$(ts).bind("mouseover",function(e){ptr=$(e.target||e.srcElement).parents("tr.jqgrow");if($(ptr).attr("class")!=="subgrid"){$(ptr).addClass("ui-state-hover")}return false}).bind("mouseout",function(e){ptr=$(e.target||e.srcElement).parents("tr.jqgrow");$(ptr).removeClass("ui-state-hover");return false})}var ri,ci;$(ts).before(grid.hDiv).click(function(e){td=(e.target||e.srcElement);if(td.href){return true}var scb=$(td).hasClass("cbox");ptr=$(td,ts.rows).parents("tr.jqgrow");if($(ptr).length===0){return false}var cSel=true;if(bSR){cSel=bSR(ptr.attr("id"))}if(cSel===true){if(ts.p.cellEdit===true){if(ts.p.multiselect&&scb){$(ts).setSelection(false,true,ptr)}else{ri=ptr[0].rowIndex;ci=!$(td).is("td")?$(td).parents("td:first")[0].cellIndex:td.cellIndex;if(isMSIE){ci=$.getAbsoluteIndex(ptr[0],ci)}try{$(ts).editCell(ri,ci,true)}catch(e){}}}else{if(!ts.p.multikey){if(ts.p.multiselect&&ts.p.multiboxonly){if(scb){$(ts).setSelection(false,true,ptr)}}else{$(ts).setSelection(false,true,ptr)}}else{if(e[ts.p.multikey]){$(ts).setSelection(false,true,ptr)}else{if(ts.p.multiselect&&scb){scb=$("[id^=jqg_]",ptr).attr("checked");$("[id^=jqg_]",ptr).attr("checked",!scb)}}}}if(onSC){ri=ptr[0].id;ci=!$(td).is("td")?$(td).parents("td:first")[0].cellIndex:td.cellIndex;if(isMSIE){ci=$.getAbsoluteIndex(ptr[0],ci)}onSC(ri,ci,$(td).html(),td)}}e.stopPropagation()}).bind("reloadGrid",function(e){if(ts.p.treeGrid===true){ts.p.datatype=ts.p.treedatatype}if(ts.p.datatype=="local"){$(ts).resetSelection()}else{if(!ts.p.treeGrid){ts.p.selrow=null;if(ts.p.multiselect){ts.p.selarrrow=[];$("#cb_jqg",ts.grid.hDiv).attr("checked",false)}if(ts.p.cellEdit){ts.p.savedRow=[]}}}if(ts.p.scroll===true){$("tbody tr",ts.grid.bDiv).remove()}ts.grid.populate();return false});if(ondblClickRow){$(this).dblclick(function(e){td=(e.target||e.srcElement);ptr=$(td,ts.rows).parents("tr.jqgrow");if($(ptr).length===0){return false}ts.p.ondblClickRow($(ptr).attr("id"));return false})}if(onRightClickRow){$(this).bind("contextmenu",function(e){td=(e.target||e.srcElement);ptr=$(td,ts.rows).parents("tr.jqgrow");if($(ptr).length===0){return false}if(!ts.p.multiselect){$(ts).setSelection(false,true,ptr)}ts.p.onRightClickRow($(ptr).attr("id"));return false})}grid.bDiv=document.createElement("div");$(grid.bDiv).append(this).addClass("ui-jqgrid-bdiv").css({height:ts.p.height+(isNaN(ts.p.height)?"":"px"),width:(grid.width)+"px"}).scroll(function(e){grid.scrollGrid()});$("table:first",grid.bDiv).css({width:ts.p.tblwidth+"px"});if(isMSIE){if($("tbody",this).size()===2){$("tbody:first",this).remove()}if(ts.p.multikey){$(grid.bDiv).bind("selectstart",function(){return false})}if(ts.p.treeGrid){$(grid.bDiv).css("position","relative")}}else{if(ts.p.multikey){$(grid.bDiv).bind("mousedown",function(){return false})}}if(hg){$(grid.bDiv).hide()}grid.cDiv=document.createElement("div");var arf=ts.p.hidegrid===true?$("<a role='link' href='javascript:void(0)'/>").addClass("ui-jqgrid-titlebar-close HeaderButton").hover(function(){arf.addClass("ui-state-hover")},function(){arf.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-circle-triangle-n'></span>"):"";$(grid.cDiv).append(arf).append("<span class='ui-jqgrid-title'>"+ts.p.caption+"</span>").addClass("ui-jqgrid-titlebar ui-widget-header ui-corner-tl ui-corner-tr ui-helper-clearfix");$(grid.cDiv).insertBefore(grid.hDiv);if(ts.p.toolbar[0]){grid.uDiv=document.createElement("div");if(ts.p.toolbar[1]=="top"){$(grid.uDiv).insertBefore(grid.hDiv)}else{if(ts.p.toolbar[1]=="bottom"){$(grid.uDiv).insertAfter(grid.hDiv)}}if(ts.p.toolbar[1]=="both"){grid.ubDiv=document.createElement("div");$(grid.uDiv).insertBefore(grid.hDiv).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id);$(grid.ubDiv).insertAfter(grid.hDiv).addClass("ui-userdata ui-state-default").attr("id","tb_"+this.id);ts.p._height+=IntNum($(grid.ubDiv).height());if(hg){$(grid.ubDiv).hide()}}else{$(grid.uDiv).width(grid.width).addClass("ui-userdata ui-state-default").attr("id","t_"+this.id)}ts.p._height+=IntNum($(grid.uDiv).height());if(hg){$(grid.uDiv).hide()}}if(ts.p.caption){ts.p._height+=parseInt($(grid.cDiv,ts).height(),10);var tdt=ts.p.datatype;if(ts.p.hidegrid===true){$(".ui-jqgrid-titlebar-close",grid.cDiv).toggle(function(){$(".ui-jqgrid-bdiv, .ui-jqgrid-hdiv","#gview_"+ts.p.id).slideUp("fast");if(ts.p.pager){$(ts.p.pager).slideUp("fast")}if(ts.p.toolbar[0]===true){if(ts.p.toolbar[1]=="both"){$(grid.ubDiv).slideUp("fast")}$(grid.uDiv).slideUp("fast")}$("span",this).removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s");ts.p.gridstate="hidden";if(onHdCl){if(!hg){ts.p.onHeaderClick(ts.p.gridstate)}}},function(){$(".ui-jqgrid-hdiv, .ui-jqgrid-bdiv","#gview_"+ts.p.id).slideDown("fast");if(ts.p.pager){$(ts.p.pager).slideDown("fast")}if(ts.p.toolbar[0]===true){if(ts.p.toolbar[1]=="both"){$(grid.ubDiv).slideDown("fast")}$(grid.uDiv).slideDown("fast")}$("span",this).removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n");if(hg){ts.p.datatype=tdt;populate();hg=false}ts.p.gridstate="visible";if(onHdCl){ts.p.onHeaderClick(ts.p.gridstate)}});if(hg){$(".ui-jqgrid-titlebar-close",grid.cDiv).trigger("click");ts.p.datatype="local"}}}else{$(grid.cDiv).hide()}$(grid.hDiv).after(grid.bDiv).mousemove(function(e){if(grid.resizing){grid.dragMove(e)}return false});ts.p._height+=parseInt($(grid.hDiv).height(),10);$(document).mouseup(function(e){if(grid.resizing){grid.dragEnd();return false}return true});this.updateColumns=function(){var r=this.rows[0],self=this;if(r){$("td",r).each(function(k){$(this).css("width",self.grid.headers[k].width+"px")});this.grid.cols=r.cells}return this};ts.formatCol=function(a,b){return formatCol(a,b)};ts.sortData=function(a,b,c){sortData(a,b,c)};ts.updatepager=function(a){updatepager(a)};ts.formatter=function(rowId,cellval,colpos,rwdat,act){return formatter(rowId,cellval,colpos,rwdat,act)};$.extend(grid,{populate:function(){populate()}});this.grid=grid;ts.addXmlData=function(d){addXmlData(d,ts.grid.bDiv)};ts.addJSONData=function(d){addJSONData(d,ts.grid.bDiv)};populate();ts.p.hiddengrid=false;$(window).unload(function(){$(this).empty();this.grid=null;this.p=null})})}})(jQuery);(function($){$.fmatter={};$.fn.fmatter=function(formatType,cellval,opts,rwd,act){opts=$.extend({},$.jgrid.formatter,opts);return fireFormatter(formatType,cellval,opts,rwd,act)};$.fmatter.util={NumberFormat:function(nData,opts){if(!isNumber(nData)){nData*=1}if(isNumber(nData)){var bNegative=(nData<0);var sOutput=nData+"";var sDecimalSeparator=(opts.decimalSeparator)?opts.decimalSeparator:".";var nDotIndex;if(isNumber(opts.decimalPlaces)){var nDecimalPlaces=opts.decimalPlaces;var nDecimal=Math.pow(10,nDecimalPlaces);sOutput=Math.round(nData*nDecimal)/nDecimal+"";nDotIndex=sOutput.lastIndexOf(".");if(nDecimalPlaces>0){if(nDotIndex<0){sOutput+=sDecimalSeparator;nDotIndex=sOutput.length-1}else{if(sDecimalSeparator!=="."){sOutput=sOutput.replace(".",sDecimalSeparator)}}while((sOutput.length-1-nDotIndex)<nDecimalPlaces){sOutput+="0"}}}if(opts.thousandsSeparator){var sThousandsSeparator=opts.thousandsSeparator;nDotIndex=sOutput.lastIndexOf(sDecimalSeparator);nDotIndex=(nDotIndex>-1)?nDotIndex:sOutput.length;var sNewOutput=sOutput.substring(nDotIndex);var nCount=-1;for(var i=nDotIndex;i>0;i--){nCount++;if((nCount%3===0)&&(i!==nDotIndex)&&(!bNegative||(i>1))){sNewOutput=sThousandsSeparator+sNewOutput}sNewOutput=sOutput.charAt(i-1)+sNewOutput}sOutput=sNewOutput}sOutput=(opts.prefix)?opts.prefix+sOutput:sOutput;sOutput=(opts.suffix)?sOutput+opts.suffix:sOutput;return sOutput}else{return nData}},DateFormat:function(format,date,newformat,opts){var token=/\\.|[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(value,length){value=String(value);length=parseInt(length)||2;while(value.length<length){value="0"+value}return value},ts={m:1,d:1,y:1970,h:0,i:0,s:0},timestamp=0,dM,k,hl,dateFormat=["i18n"];dateFormat.i18n={dayNames:opts.dayNames,monthNames:opts.monthNames};date=date.split(/[\\\/:_;.\t\T\s-]/);format=format.split(/[\\\/:_;.\t\T\s-]/);for(k=0,hl=format.length;k<hl;k++){if(format[k]=="M"){dM=$.inArray(date[k],dateFormat.i18n.monthNames);if(dM!==-1&&dM<12){date[k]=dM+1}}if(format[k]=="F"){dM=$.inArray(date[k],dateFormat.i18n.monthNames);if(dM!==-1&&dM>11){date[k]=dM+1-12}}ts[format[k].toLowerCase()]=parseInt(date[k],10)}ts.m=parseInt(ts.m)-1;var ty=ts.y;if(ty>=70&&ty<=99){ts.y=1900+ts.y}else{if(ty>=0&&ty<=69){ts.y=2000+ts.y}}timestamp=new Date(ts.y,ts.m,ts.d,ts.h,ts.i,ts.s,0);if(opts.masks.newformat){newformat=opts.masks.newformat}else{if(!newformat){newformat="Y-m-d"}}var G=timestamp.getHours(),i=timestamp.getMinutes(),j=timestamp.getDate(),n=timestamp.getMonth()+1,o=timestamp.getTimezoneOffset(),s=timestamp.getSeconds(),u=timestamp.getMilliseconds(),w=timestamp.getDay(),Y=timestamp.getFullYear(),N=(w+6)%7+1,z=(new Date(Y,n-1,j)-new Date(Y,0,1))/86400000,flags={d:pad(j),D:dateFormat.i18n.dayNames[w],j:j,l:dateFormat.i18n.dayNames[w+7],N:N,S:opts.S(j),w:w,z:z,W:N<5?Math.floor((z+N-1)/7)+1:Math.floor((z+N-1)/7)||((new Date(Y-1,0,1).getDay()+6)%7<4?53:52),F:dateFormat.i18n.monthNames[n-1+12],m:pad(n),M:dateFormat.i18n.monthNames[n-1],n:n,t:"?",L:"?",o:"?",Y:Y,y:String(Y).substring(2),a:G<12?opts.AmPm[0]:opts.AmPm[1],A:G<12?opts.AmPm[2]:opts.AmPm[3],B:"?",g:G%12||12,G:G,h:pad(G%12||12),H:pad(G),i:pad(i),s:pad(s),u:u,e:"?",I:"?",O:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),P:"?",T:(String(timestamp).match(timezone)||[""]).pop().replace(timezoneClip,""),Z:"?",c:"?",r:"?",U:Math.floor(timestamp/1000)};return newformat.replace(token,function($0){return $0 in flags?flags[$0]:$0.substring(1)})}};$.fn.fmatter.defaultFormat=function(cellval,opts){return(isValue(cellval)&&cellval!=="")?cellval:opts.defaultValue?opts.defaultValue:"&#160;"};$.fn.fmatter.email=function(cellval,opts){if(!isEmpty(cellval)){return"<a href='mailto:"+cellval+"'>"+cellval+"</a>"}else{return $.fn.fmatter.defaultFormat(cellval,opts)}};$.fn.fmatter.checkbox=function(cval,opts){var op=$.extend({},opts.checkbox),ds;if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions)}if(op.disabled===true){ds="disabled"}else{ds=""}cval=cval+"";cval=cval.toLowerCase();var bchk=cval.search(/(false|0|no|off)/i)<0?" checked='checked' ":"";return"<input type='checkbox' "+bchk+" value='"+cval+"' offval='no' "+ds+"/>"},$.fn.fmatter.link=function(cellval,opts){var op={target:opts.target};var target="";if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions)}if(op.target){target="target="+op.target}if(!isEmpty(cellval)){return"<a "+target+" href='"+cellval+"'>"+cellval+"</a>"}else{return $.fn.fmatter.defaultFormat(cellval,opts)}};$.fn.fmatter.showlink=function(cellval,opts){var op={baseLinkUrl:opts.baseLinkUrl,showAction:opts.showAction,addParam:opts.addParam,target:opts.target,idName:opts.idName},target="";if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions)}if(op.target){target="target="+op.target}idUrl=op.baseLinkUrl+op.showAction+"?"+op.idName+"="+opts.rowId+op.addParam;if(isString(cellval)){return"<a "+target+" href='"+idUrl+"'>"+cellval+"</a>"}else{return $.fn.fmatter.defaultFormat(cellval,opts)}};$.fn.fmatter.integer=function(cellval,opts){var op=$.extend({},opts.integer);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions)}if(isEmpty(cellval)){return op.defaultValue}return $.fmatter.util.NumberFormat(cellval,op)};$.fn.fmatter.number=function(cellval,opts){var op=$.extend({},opts.number);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions)}if(isEmpty(cellval)){return op.defaultValue}return $.fmatter.util.NumberFormat(cellval,op)};$.fn.fmatter.currency=function(cellval,opts){var op=$.extend({},opts.currency);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions)}if(isEmpty(cellval)){return op.defaultValue}return $.fmatter.util.NumberFormat(cellval,op)};$.fn.fmatter.date=function(cellval,opts,act){var op=$.extend({},opts.date);if(!isUndefined(opts.colModel.formatoptions)){op=$.extend({},op,opts.colModel.formatoptions)}if(!op.reformatAfterEdit&&act=="edit"){return $.fn.fmatter.defaultFormat(cellval,opts)}else{if(!isEmpty(cellval)){return $.fmatter.util.DateFormat(op.srcformat,cellval,op.newformat,op)}else{return $.fn.fmatter.defaultFormat(cellval,opts)}}};$.fn.fmatter.select=function(cellval,opts,act){if(act=="edit"){return $.fn.fmatter.defaultFormat(cellval,opts)}else{if(!isEmpty(cellval)){var oSelect=false;if(!isUndefined(opts.colModel.editoptions)){oSelect=opts.colModel.editoptions.value}if(oSelect){var ret=[],msl=opts.colModel.editoptions.multiple===true?true:false,scell=[],sv;if(msl){scell=cellval.split(",");scell=$.map(scell,function(n){return $.trim(n)})}if(isString(oSelect)){var so=oSelect.split(";"),j=0;for(var i=0;i<so.length;i++){sv=so[i].split(":");if(msl){if(jQuery.inArray(sv[0],scell)>-1){ret[j]=sv[1];j++}}else{if($.trim(sv[0])==$.trim(cellval)){ret[0]=sv[1];break}}}}else{if(isObject(oSelect)){if(msl){ret=jQuery.map(scel,function(n,i){return oSelect[n]})}ret[0]=oSelect[cellval]||""}}return ret.join(", ")}else{return $.fn.fmatter.defaultFormat(cellval,opts)}}}};$.unformat=function(cellval,options,pos,cnt){var ret,formatType=options.colModel.formatter,op=options.colModel.formatoptions||{};if(formatType!=="undefined"&&isString(formatType)){var opts=$.jgrid.formatter||{},stripTag;switch(formatType){case"link":case"showlink":case"email":ret=$(cellval).text();break;case"integer":op=$.extend({},opts.integer,op);stripTag=eval("/"+op.thousandsSeparator+"/g");ret=$(cellval).text().replace(stripTag,"");break;case"number":op=$.extend({},opts.number,op);stripTag=eval("/"+op.thousandsSeparator+"/g");ret=$(cellval).text().replace(op.decimalSeparator,".").replace(stripTag,"");break;case"currency":op=$.extend({},opts.currency,op);stripTag=eval("/"+op.thousandsSeparator+"/g");ret=$(cellval).text().replace(op.decimalSeparator,".").replace(op.prefix,"").replace(op.suffix,"").replace(stripTag,"");break;case"checkbox":var cbv=(options.colModel.editoptions)?options.colModel.editoptions.value.split(":"):["Yes","No"];ret=$("input",cellval).attr("checked")?cbv[0]:cbv[1];break}}return ret?ret:cnt===true?$(cellval).text():$.htmlDecode($(cellval).html())};function fireFormatter(formatType,cellval,opts,rwd,act){formatType=formatType.toLowerCase();var v=cellval;switch(formatType){case"link":v=$.fn.fmatter.link(cellval,opts);break;case"showlink":v=$.fn.fmatter.showlink(cellval,opts);break;case"email":v=$.fn.fmatter.email(cellval,opts);break;case"currency":v=$.fn.fmatter.currency(cellval,opts);break;case"date":v=$.fn.fmatter.date(cellval,opts,act);break;case"number":v=$.fn.fmatter.number(cellval,opts);break;case"integer":v=$.fn.fmatter.integer(cellval,opts);break;case"checkbox":v=$.fn.fmatter.checkbox(cellval,opts);break;case"select":v=$.fn.fmatter.select(cellval,opts,act);break}return v}function debug($obj){if(window.console&&window.console.log){window.console.log($obj)}}isValue=function(o){return(isObject(o)||isString(o)||isNumber(o)||isBoolean(o))};isBoolean=function(o){return typeof o==="boolean"};isNull=function(o){return o===null};isNumber=function(o){return typeof o==="number"&&isFinite(o)};isString=function(o){return typeof o==="string"};isEmpty=function(o){if(!isString(o)&&isValue(o)){return false}else{if(!isValue(o)){return true}}o=$.trim(o).replace(/\&nbsp\;/ig,"").replace(/\&#160\;/ig,"");return o===""};isUndefined=function(o){return typeof o==="undefined"};isObject=function(o){return(o&&(typeof o==="object"||isFunction(o)))||false};isFunction=function(o){return typeof o==="function"}})(jQuery);(function(a){a.fn.extend({getColProp:function(d){var b={},f=this[0];if(!f.grid){return}var e=f.p.colModel;for(var c=0;c<e.length;c++){if(e[c].name==d){b=e[c];break}}return b},setColProp:function(c,b){return this.each(function(){if(this.grid){if(b){var e=this.p.colModel;for(var d=0;d<e.length;d++){if(e[d].name==c){a.extend(this.p.colModel[d],b);break}}}}})},sortGrid:function(c,b){return this.each(function(){var g=this,d=-1;if(!g.grid){return}if(!c){c=g.p.sortname}for(var f=0;f<g.p.colModel.length;f++){if(g.p.colModel[f].index==c||g.p.colModel[f].name==c){d=f;break}}if(d!=-1){var e=g.p.colModel[d].sortable;if(typeof e!=="boolean"){e=true}if(typeof b!=="boolean"){b=false}if(e){g.sortData("jqgh_"+c,d,b)}}})},GridDestroy:function(){return this.each(function(){if(this.grid){if(this.p.pager){a(this.p.pager).remove()}var c=this.id;try{a("#gbox_"+c).remove()}catch(b){}}})},GridUnload:function(){return this.each(function(){if(!this.grid){return}var d={id:a(this).attr("id"),cl:a(this).attr("class")};if(this.p.pager){a(this.p.pager).empty().removeClass("ui-state-default ui-jqgrid-pager corner-bottom")}var b=document.createElement("table");a(b).attr({id:d.id});b.className=d.cl;var c=this.id;a(b).removeClass("ui-jqgrid-btable");if(a(this.p.pager).parents("#gbox_"+c).length===1){a(b).insertBefore("#gbox_"+c).show();a(this.p.pager).insertBefore("#gbox_"+c)}else{a(b).insertBefore("#gbox_"+c).show()}a("#gbox_"+c).remove()})},filterGrid:function(c,b){b=a.extend({gridModel:false,gridNames:false,gridToolbar:false,filterModel:[],formtype:"horizontal",autosearch:true,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:false,enableClear:false,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:"",marksearched:true},b||{});return this.each(function(){var l=this;this.p=b;if(this.p.filterModel.length==0&&this.p.gridModel===false){alert("No filter is set");return}if(!c){alert("No target grid is set!");return}this.p.gridid=c.indexOf("#")!=-1?c:"#"+c;var d=a(this.p.gridid).getGridParam("colModel");if(d){if(this.p.gridModel===true){var e=a(this.p.gridid)[0];var g;a.each(d,function(o,p){var m=[];this.search=this.search===false?false:true;if(this.editrules&&this.editrules.searchhidden===true){g=true}else{if(this.hidden===true){g=false}else{g=true}}if(this.search===true&&g===true){if(l.p.gridNames===true){m.label=e.p.colNames[o]}else{m.label=""}m.name=this.name;m.index=this.index||this.name;m.stype=this.edittype||"text";if(m.stype!="select"){m.stype="text"}m.defval=this.defval||"";m.surl=this.surl||"";m.sopt=this.editoptions||{};m.width=this.width;l.p.filterModel.push(m)}})}else{a.each(l.p.filterModel,function(o,p){for(var m=0;m<d.length;m++){if(this.name==d[m].name){this.index=d[m].index||this.name;break}}if(!this.index){this.index=this.name}})}}else{alert("Could not get grid colModel");return}var h=function(){var p={},o=0,m;var n=a(l.p.gridid)[0];if(a.isFunction(l.p.beforeSearch)){l.p.beforeSearch()}a.each(l.p.filterModel,function(s,u){switch(this.stype){case"select":m=a("select[name="+this.name+"]",l).val();if(m){p[this.index]=m;if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).addClass("dirty-cell")}o++}else{if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).removeClass("dirty-cell")}try{delete n.p.postData[this.index]}catch(t){}}break;default:m=a("input[name="+this.name+"]",l).val();if(m){p[this.index]=m;if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).addClass("dirty-cell")}o++}else{if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).removeClass("dirty-cell")}try{delete n.p.postData[this.index]}catch(t){}}}});var q=o>0?true:false;n.p.postData=a.extend(n.p.postData,p);var r;if(l.p.url){r=a(n).getGridParam("url");a(n).setGridParam({url:l.p.url})}a(n).setGridParam({search:q,page:1}).trigger("reloadGrid");if(r){a(n).setGridParam({url:r})}if(a.isFunction(l.p.afterSearch)){l.p.afterSearch()}};var k=function(){var p={},m,o=0;var n=a(l.p.gridid)[0];if(a.isFunction(l.p.beforeClear)){l.p.beforeClear()}a.each(l.p.filterModel,function(s,v){m=(this.defval)?this.defval:"";if(!this.stype){this.stype=="text"}switch(this.stype){case"select":if(m){var u;a("select[name="+this.name+"] option",l).each(function(){if(a(this).text()==m){this.selected=true;u=a(this).val();return false}});p[this.index]=u||"";if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).addClass("dirty-cell")}o++}else{if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).removeClass("dirty-cell")}try{delete n.p.postData[this.index]}catch(t){}}break;case"text":a("input[name="+this.name+"]",l).val(m);if(m){p[this.index]=m;if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).addClass("dirty-cell")}o++}else{if(l.p.marksearched){a("#jqgh_"+this.name,n.grid.hDiv).removeClass("dirty-cell")}try{delete n.p.postData[this.index]}catch(t){}}}});var q=o>0?true:false;n.p.postData=a.extend(n.p.postData,p);var r;if(l.p.url){r=a(n).getGridParam("url");a(n).setGridParam({url:l.p.url})}a(n).setGridParam({search:q,page:1}).trigger("reloadGrid");if(r){a(n).setGridParam({url:r})}if(a.isFunction(l.p.afterClear)){l.p.afterClear()}};var i=function(){var q=document.createElement("tr");var n,s,m,o,r,p;if(l.p.formtype=="horizontal"){a(f).append(q)}a.each(l.p.filterModel,function(A,v){o=document.createElement("td");a(o).append("<label for='"+this.name+"'>"+this.label+"</label>");r=document.createElement("td");var z=this;if(!this.stype){this.stype="text"}switch(this.stype){case"select":if(this.surl){a(r).load(this.surl,function(){if(z.defval){a("select",this).val(z.defval)}a("select",this).attr({name:z.name,id:"sg_"+z.name});if(z.sopt){a("select",this).attr(z.sopt)}if(l.p.gridToolbar===true&&z.width){a("select",this).width(z.width)}if(l.p.autosearch===true){a("select",this).change(function(E){h();return false})}})}else{if(z.sopt.value){var t=z.sopt.value;if(typeof t==="string"){var u=t.split(";"),D,x;var w=document.createElement("select");a(w).attr({name:z.name,id:"sg_"+z.name}).attr(z.sopt);for(var y=0;y<u.length;y++){D=u[y].split(":");x=document.createElement("option");x.value=D[0];x.innerHTML=D[1];if(D[1]==z.defval){x.selected="selected"}w.appendChild(x)}}else{if(typeof t==="object"){for(var C in t){A++;x=document.createElement("option");x.value=C;x.innerHTML=t[C];if(t[C]==z.defval){x.selected="selected"}w.appendChild(x)}}}if(l.p.gridToolbar===true&&z.width){a(w).width(z.width)}a(r).append(w);if(l.p.autosearch===true){a(w).change(function(E){h();return false})}}}break;case"text":var B=this.defval?this.defval:"";a(r).append("<input type='text' name='"+this.name+"' id='sg_"+this.name+"' value='"+B+"'/>");if(z.sopt){a("input",r).attr(z.sopt)}if(l.p.gridToolbar===true&&z.width){if(a.browser.msie){a("input",r).width(z.width-4)}else{a("input",r).width(z.width-2)}}if(l.p.autosearch===true){a("input",r).keypress(function(F){var E=F.charCode?F.charCode:F.keyCode?F.keyCode:0;if(E==13){h();return false}return this})}break}if(l.p.formtype=="horizontal"){if(l.p.gridToolbar===true&&l.p.gridNames===false){a(q).append(r)}else{a(q).append(o).append(r)}a(q).append(r)}else{n=document.createElement("tr");a(n).append(o).append(r);a(f).append(n)}});r=document.createElement("td");if(l.p.enableSearch===true){s="<input type='button' id='sButton' class='"+l.p.buttonclass+"' value='"+l.p.searchButton+"'/>";a(r).append(s);a("input#sButton",r).click(function(){h();return false})}if(l.p.enableClear===true){m="<input type='button' id='cButton' class='"+l.p.buttonclass+"' value='"+l.p.clearButton+"'/>";a(r).append(m);a("input#cButton",r).click(function(){k();return false})}if(l.p.enableClear===true||l.p.enableSearch===true){if(l.p.formtype=="horizontal"){a(q).append(r)}else{n=document.createElement("tr");a(n).append("<td>&nbsp;</td>").append(r);a(f).append(n)}}};var j=a("<form name='SearchForm' style=display:inline;' class='"+this.p.formclass+"'></form>");var f=a("<table class='"+this.p.tableclass+"' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>");a(j).append(f);i();a(this).append(j);this.triggerSearch=function(){h()};this.clearSearch=function(){k()}})},filterToolbar:function(b){b=a.extend({autosearch:true,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,searchurl:""},b||{});return this.each(function(){var g=this;var c=function(){var n={},m=0,l;if(a.isFunction(b.beforeSearch)){b.beforeSearch()}a.each(g.p.colModel,function(q,s){switch(this.stype){case"select":l=a("select[name="+this.name+"]",g.grid.hDiv).val();if(l){n[this.index]=l;m++}else{try{delete g.p.postData[this.index]}catch(r){}}break;case"text":l=a("input[name="+this.name+"]",g.grid.hDiv).val();if(l){n[this.index]=l;m++}else{try{delete g.p.postData[this.index]}catch(r){}}}});var o=m>0?true:false;g.p.postData=a.extend(g.p.postData,n);var p;if(g.p.searchurl){p=g.p.url;a(g).setGridParam({url:g.p.searchurl})}a(g).setGridParam({search:o,page:1}).trigger("reloadGrid");if(p){a(g).setGridParam({url:p})}if(a.isFunction(b.afterSearch)){b.afterSearch()}};var j=function(){var n={},l,m=0;if(a.isFunction(b.beforeClear)){b.beforeClear()}a.each(g.p.colModel,function(q,t){l=(this.defval)?this.defval:"";switch(this.stype){case"select":if(l){var s;a("select[name="+this.name+"] option",g.grid.hDiv).each(function(){if(a(this).text()==l){this.selected=true;s=a(this).val();return false}});n[this.index]=s||"";m++}else{try{delete g.p.postData[this.index]}catch(r){}}break;case"text":a("input[name="+this.name+"]",g.grid.hDiv).val(l);if(l){n[this.index]=l;m++}else{try{delete g.p.postData[this.index]}catch(r){}}}});var o=m>0?true:false;g.p.postData=a.extend(g.p.postData,n);var p;if(g.p.searchurl){p=g.p.url;a(g).setGridParam({url:g.p.searchurl})}a(g).setGridParam({search:o,page:1}).trigger("reloadGrid");if(p){a(g).setGridParam({url:p})}if(a.isFunction(b.afterClear)){b.afterClear()}};var k=function(){a("tr.ui-search-toolbar",g.grid.hDiv).toggle()};function f(l,n){var m=a(l);if(m[0]!=null){jQuery.each(n,function(){if(this.data!=null){m.bind(this.type,this.data,this.fn)}else{m.bind(this.type,this.fn)}})}}var h=a("<tr class='ui-search-toolbar' role='rowheader'></tr>"),d,i,e;a.each(g.p.colModel,function(s,o){var u=this;d=a("<th role='columnheader' class='ui-state-default ui-th-column'></th>");i=a("<div style='width:100%;position:relative;'></div>");if(this.hidden===true){a(d).css("display","none")}this.search=this.search===false?false:true;if(typeof this.stype=="undefined"){this.stype="text"}e=a.extend({},this.searchoptions||{});if(this.search){switch(this.stype){case"select":if(this.surl){a(i).load(this.surl,{_nsd:(new Date().getTime())},function(){if(e.defaultValue){a("select",this).val(e.defaultValue)}a("select",this).attr({name:u.name,id:"gs_"+u.name});if(e.attr){a("select",this).attr(e.attr)}a("select",this).css({width:"100%"});if(e.dataInit!=null){e.dataInit(a("select",this)[0])}if(e.dataEvents!=null){f(a("select",this)[0],e.dataEvents)}if(b.autosearch===true){a("select",this).change(function(n){c();return false})}})}else{if(u.editoptions&&u.editoptions.value){var l=u.editoptions.value,p=document.createElement("select");p.style.width="100%";a(p).attr({name:u.name,id:"gs_"+u.name});if(typeof l==="string"){var m=l.split(";"),w,q;for(var r=0;r<m.length;r++){w=m[r].split(":");q=document.createElement("option");q.value=w[0];q.innerHTML=w[1];p.appendChild(q)}}else{if(typeof l==="object"){for(var v in l){s++;q=document.createElement("option");q.value=v;q.innerHTML=l[v];p.appendChild(q)}}}if(e.defaultValue){a(p).val(e.defaultValue)}if(e.attr){a(p).attr(e.attr)}if(e.dataInit!=null){e.dataInit(p)}if(e.dataEvents!=null){f(p,e.dataEvents)}a(i).append(p);if(b.autosearch===true){a(p).change(function(n){c();return false})}}}break;case"text":var t=e.defaultValue?e.defaultValue:"";a(i).append("<input type='text' style='width:95%;padding:0px;' name='"+u.name+"' id='gs_"+u.name+"' value='"+t+"'/>");if(e.attr){a("input",i).attr(e.attr)}if(e.dataInit!=null){e.dataInit(a("input",i)[0])}if(e.dataEvents!=null){f(a("input",i)[0],e.dataEvents)}if(b.autosearch===true){a("input",i).keypress(function(x){var n=x.charCode?x.charCode:x.keyCode?x.keyCode:0;if(n==13){c();return false}return this})}break}}a(d).append(i);a(h).append(d)});a("table thead",g.grid.hDiv).append(h);this.triggerToolbar=function(){c()};this.clearToolbar=function(){j()};this.toggleToolbar=function(){k()}})}})})(jQuery);var showModal=function(a){a.w.show()};var closeModal=function(a){a.w.hide().attr("aria-hidden","true");if(a.o){a.o.remove()}};var createModal=function(i,d,a,k,m,l){var h=document.createElement("div");h.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog";h.id=i.themodal;var b=document.createElement("div");b.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix";b.id=i.modalhead;jQuery(b).append("<span class='ui-jqdialog-title'>"+a.caption+"</span>");var j=jQuery("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){j.addClass("ui-state-hover")},function(){j.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick jqmClose'></span>");jQuery(b).append(j);var g=document.createElement("div");jQuery(g).addClass("ui-jqdialog-content ui-widget-content").attr("id",i.modalcontent);jQuery(g).append(d);h.appendChild(g);jQuery(h).prepend(b);if(l===true){jQuery("body").append(h)}else{jQuery(h).insertBefore(k)}if(typeof a.jqModal==="undefined"){a.jqModal=true}if(jQuery.fn.jqm&&a.jqModal===true){if(a.left==0&&a.top==0){var f=[];f=findPos(m);a.left=f[0]+4;a.top=f[1]+4}}else{jQuery("a.ui-jqdialog-titlebar-close",b).click(function(n){hideModal("#"+i.themodal,{gb:a.gbox,jqm:a.jqModal});return false})}if(a.width==0||!a.width){a.width=300}if(a.height==0||!a.height){a.height=200}if(!a.zIndex){a.zIndex=950}jQuery(h).css({top:a.top+"px",left:a.left+"px",width:isNaN(a.width)?"auto":a.width+"px",height:isNaN(a.height)?"auto":a.height+"px",zIndex:a.zIndex,overflow:"hidden"}).attr({tabIndex:"-1",role:"dialog","aria-labelledby":i.modalhead,"aria-hidden":"true"});if(typeof a.drag=="undefined"){a.drag=true}if(typeof a.resize=="undefined"){a.resize=true}if(a.drag){jQuery(b).css("cursor","move");if(jQuery.fn.jqDrag){jQuery(h).jqDrag(b)}else{try{jQuery(h).draggable({handle:jQuery("#"+b.id)})}catch(c){}}}if(a.resize){if(jQuery.fn.jqResize){jQuery(h).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>");jQuery(h).jqResize(".jqResize")}else{try{jQuery(h).resizable({handles:"se"})}catch(c){}}}if(a.closeOnEscape&&a.closeOnEscape===true){jQuery(h).keydown(function(n){if(n.which==27){hideModal(this,{gb:a.gbox,jqm:a.jqModal})}})}};var viewModal=function(a,c){c=jQuery.extend({toTop:true,overlay:10,modal:false,onShow:showModal,onHide:closeModal,gbox:"",jqm:true},c||{});if(jQuery.fn.jqm&&c.jqm==true){jQuery(a).attr("aria-hidden","false").jqm(c).jqmShow()}else{if(c.gbox){jQuery(".jqgrid-overlay",c.gbox).show()}jQuery(a).show().attr("aria-hidden","false");try{jQuery(":input:visible",a)[0].focus()}catch(b){}}return false};var hideModal=function(a,c){c=jQuery.extend({jqm:true,gb:""},c||{});if(jQuery.fn.jqm&&c.jqm===true){jQuery(a).attr("aria-hidden","true").jqmHide()}else{if(c.gb!=""){try{jQuery(".jqgrid-overlay",c.gb).hide()}catch(b){}}jQuery(a).hide().attr("aria-hidden","true")}};function info_dialog(b,e,c,a){var d="<div id='info_id'>";d+="<div align='center'><br />"+e+"<br /><br />";d+="<input type='button' size='10' id='closedialog' class='jqmClose EditButton' value='"+c+"' />";d+="</div></div>";createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content"},d,{width:290,height:120,drag:false,resize:false,caption:"<b>"+b+"</b>",left:250,top:170,closeOnEscape:true},"","",true);jQuery("#closedialog","#info_id").addClass("ui-state-default ui-corner-all").height(21).css({padding:" .2em .5em",cursor:"pointer"}).hover(function(){jQuery(this).addClass("ui-state-hover")},function(){jQuery(this).removeClass("ui-state-hover")});if(jQuery.fn.jqm){}else{jQuery("#closedialog","#info_id").click(function(f){hideModal("#info_dialog");return false})}viewModal("#info_dialog",{onHide:function(f){f.w.hide().remove();if(f.o){f.o.remove()}},modal:true})}function findPos(a){var b=curtop=0;if(a.offsetParent){do{b+=a.offsetLeft;curtop+=a.offsetTop}while(a=a.offsetParent)}return[b,curtop]}function isArray(a){if(a.constructor.toString().indexOf("Array")==-1){return false}else{return true}}function createEl(h,q,f){var g="";if(q.defaultValue){delete q.defaultValue}function o(i,e){if(jQuery.isFunction(e.dataInit)){i.id=e.id;e.dataInit(i);delete e.id;delete e.dataInit}if(e.dataEvents){jQuery.each(e.dataEvents,function(){if(this.data!=null){jQuery(i).bind(this.type,this.data,this.fn)}else{jQuery(i).bind(this.type,this.fn)}});delete e.dataEvents}return e}switch(h){case"textarea":g=document.createElement("textarea");if(!q.cols){jQuery(g).css("width","98%")}if(f=="&nbsp;"||f=="&#160;"||(f.length==1&&f.charCodeAt(0)==160)){f=""}q=o(g,q);jQuery(g).val(f).attr(q);break;case"checkbox":g=document.createElement("input");g.type="checkbox";if(!q.value){f=f.toLowerCase();if(f.search(/(false|0|no|off|undefined)/i)<0&&f!==""){g.checked=true;g.defaultChecked=true;g.value=f}else{g.value="on"}jQuery(g).attr("offval","off")}else{var a=q.value.split(":");if(f===a[0]){g.checked=true;g.defaultChecked=true}g.value=a[0];jQuery(g).attr("offval",a[1]);try{delete q.value}catch(l){}}q=o(g,q);jQuery(g).attr(q);break;case"select":var p=q.multiple===true?true:false;g=document.createElement("select");if(q.dataUrl!=null){jQuery.get(q.dataUrl,{_nsd:(new Date().getTime())},function(r){try{delete q.dataUrl;delete q.value}catch(s){}var i=jQuery(r).html();q=o(g,q);jQuery(g).html(i).attr(q);jQuery("option",g).each(function(e){if($(this).text()==f){this.selected="selected";return false}})},"html")}else{if(q.value){var j=[],k;if(p){j=f.split(",");j=jQuery.map(j,function(e){return jQuery.trim(e)});if(typeof q.size==="undefined"){q.size=3}}else{q.size=1}if(typeof q.value==="string"){var c=q.value.split(";"),n,d;try{delete q.value}catch(l){}q=o(g,q);jQuery(g).attr(q);for(k=0;k<c.length;k++){n=c[k].split(":");d=document.createElement("option");d.value=n[0];d.innerHTML=n[1];if(!p&&n[1]==f){d.selected="selected"}if(p&&jQuery.inArray(jQuery.trim(n[1]),j)>-1){d.selected="selected"}g.appendChild(d)}}else{if(typeof q.value==="object"){var b=q.value;k=0;for(var m in b){k++;d=document.createElement("option");d.value=m;d.innerHTML=b[m];if(!p&&b[m]==f){d.selected="selected"}if(p&&jQuery.inArray(jQuery.trim(b[m]),j)>-1){d.selected="selected"}g.appendChild(d)}try{delete q.value}catch(l){}q=o(g,q);jQuery(g).attr(q)}}}}break;case"text":case"password":case"button":g=document.createElement("input");g.type=h;q=o(g,q);g.value=jQuery.htmlDecode(f);if(!q.size){jQuery(g).css({width:"98%"})}jQuery(g).attr(q);break;case"image":case"file":g=document.createElement("input");g.type=h;q=o(g,q);jQuery(g).attr(q);break}return g}function checkValues(c,l,j){var f,h,m;if(typeof(l)=="string"){for(h=0,len=j.p.colModel.length;h<len;h++){if(j.p.colModel[h].name==l){f=j.p.colModel[h].editrules;l=h;try{m=j.p.colModel[h].formoptions.label}catch(k){}break}}}else{if(l>=0){var f=j.p.colModel[l].editrules}}if(f){if(!m){m=j.p.colNames[l]}if(f.required===true){if(c.match(/^s+$/)||c==""){return[false,m+": "+jQuery.jgrid.edit.msg.required,""]}}var d=f.required===false?false:true;if(f.number===true){if(!(d===false&&isEmpty(c))){if(isNaN(c)){return[false,m+": "+jQuery.jgrid.edit.msg.number,""]}}}if(f.minValue&&!isNaN(f.minValue)){if(parseFloat(c)<parseFloat(f.minValue)){return[false,m+": "+jQuery.jgrid.edit.msg.minValue+" "+f.minValue,""]}}if(f.maxValue&&!isNaN(f.maxValue)){if(parseFloat(c)>parseFloat(f.maxValue)){return[false,m+": "+jQuery.jgrid.edit.msg.maxValue+" "+f.maxValue,""]}}var a;if(f.email===true){if(!(d===false&&isEmpty(c))){a=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;if(!a.test(c)){return[false,m+": "+jQuery.jgrid.edit.msg.email,""]}}}if(f.integer===true){if(!(d===false&&isEmpty(c))){if(isNaN(c)){return[false,m+": "+jQuery.jgrid.edit.msg.integer,""]}if((c%1!=0)||(c.indexOf(".")!=-1)){return[false,m+": "+jQuery.jgrid.edit.msg.integer,""]}}}if(f.date===true){if(!(d===false&&isEmpty(c))){var b=j.p.colModel[l].datefmt||"Y-m-d";if(!checkDate(b,c)){return[false,m+": "+jQuery.jgrid.edit.msg.date+" - "+b,""]}}}if(f.url===true){if(!(d===false&&isEmpty(c))){a=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!a.test(c)){return[false,m+": "+jQuery.jgrid.edit.msg.url,""]}}}}return[true,"",""]}function checkDate(l,c){var e={},n;l=l.toLowerCase();if(l.indexOf("/")!=-1){n="/"}else{if(l.indexOf("-")!=-1){n="-"}else{if(l.indexOf(".")!=-1){n="."}else{n="/"}}}l=l.split(n);c=c.split(n);if(c.length!=3){return false}var f=-1,m,g=-1,d=-1;for(var h=0;h<l.length;h++){var b=isNaN(c[h])?0:parseInt(c[h],10);e[l[h]]=b;m=l[h];if(m.indexOf("y")!=-1){f=h}if(m.indexOf("m")!=-1){d=h}if(m.indexOf("d")!=-1){g=h}}if(l[f]=="y"||l[f]=="yyyy"){m=4}else{if(l[f]=="yy"){m=2}else{m=-1}}var a=DaysArray(12);var k;if(f===-1){return false}else{k=e[l[f]].toString();if(m==2&&k.length==1){m=1}if(k.length!=m||e[l[f]]==0){return false}}if(d===-1){return false}else{k=e[l[d]].toString();if(k.length<1||e[l[d]]<1||e[l[d]]>12){return false}}if(g===-1){return false}else{k=e[l[g]].toString();if(k.length<1||e[l[g]]<1||e[l[g]]>31||(e[l[d]]==2&&e[l[g]]>daysInFebruary(e[l[f]]))||e[l[g]]>a[e[l[d]]]){return false}}return true}function daysInFebruary(a){return(((a%4==0)&&((!(a%100==0))||(a%400==0)))?29:28)}function DaysArray(b){for(var a=1;a<=b;a++){this[a]=31;if(a==4||a==6||a==9||a==11){this[a]=30}if(a==2){this[a]=29}}return this}function isEmpty(a){if(a.match(/^s+$/)||a==""){return true}else{return false}}function htmlEncode(a){return !a?a:String(a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};(function(b){var a=null;b.fn.extend({searchGrid:function(c){c=b.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",checkInput:false,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:false,closeOnEscape:false,multipleSearch:false,sopt:null},b.jgrid.search,c||{});return this.each(function(){var l=this;if(!l.grid){return}if(b.fn.searchFilter){var g="fbox_"+l.p.id;if(c.recreateFilter===true){b("#"+g).remove()}if(b("#"+g).html()!=null){if(b.isFunction(c.beforeShowSearch)){c.beforeShowSearch(b("#"+g))}f();if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#"+g))}}else{var n=[],u=jQuery("#"+l.p.id).getGridParam("colNames"),r=jQuery("#"+l.p.id).getGridParam("colModel"),t=["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc"],i,q,h;b.each(r,function(x,C){var z=(typeof C.search==="undefined")?true:C.search,y=(C.hidden===true),k=b.extend({},{text:u[x],value:C.name},this.searchoptions),w=(k.searchhidden===true)||true;if(k.sopt!=null){h=0;k.ops=[];for(i=0;i<k.sopt.length;i++){if((q=b.inArray(k.sopt[i],t))!=-1){k.ops[h]={op:k.sopt[i],text:c.odata[q]};h++}}}if(typeof(this.stype)==="undefined"){this.stype="text"}if(this.stype=="select"){if(k.dataUrl!=null){}else{if(this.editoptions){var j=this.editoptions.value;if(j){k.dataValues=[];if(typeof(j)==="string"){var e=j.split(";"),B;for(i=0;i<e.length;i++){B=e[i].split(":");k.dataValues[i]={value:B[0],text:B[1]}}}else{if(typeof(j)==="object"){i=0;for(var A in j){k.dataValues[i]={value:A,text:j[A]};i++}}}}}}}if((w&&z)||(z&&!y)){n.push(k)}});if(n.length>0){var p=jQuery.fn.searchFilter.defaults.operators;if(c.sopt!=null){p=[];h=0;for(i=0;c.sopt.length<0;i++){if((q=b.inArray(c.sopt[i],t))!=-1){p[h]={op:c.sopt[i],text:c.odata[q]};h++}}}b("<div id='"+g+"' role='dialog' tabindex='-1'></div>").insertBefore("#gview_"+l.p.id);jQuery("#"+g).searchFilter(n,{operators:p,onClose:d,resetText:c.Reset,searchText:c.Find,windowTitle:c.caption,rulesText:c.rulesText,matchText:c.matchText,onSearch:s,onReset:m,stringResult:c.multipleSearch});b(".ui-widget-overlay","#"+g).remove();if(c.drag===true){b("#"+g+" table thead tr:first td:first").css("cursor","move");if(jQuery.fn.jqDrag){jQuery("#"+g).jqDrag(b("#"+g+" table thead tr:first td:first"))}else{try{b("#"+g).draggable({handle:jQuery("#"+g+" table thead tr:first td:first")})}catch(o){}}}if(c.multipleSearch===false){b(".ui-del, .ui-add, .ui-del, .ui-add-last, .matchText, .rulesText","#"+g).remove();b("select[name='groupOp']","#"+g).hide()}if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#"+g))}if(b.isFunction(c.beforeShowSearch)){c.beforeShowSearch(b("#"+g))}f();if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#"+g))}if(c.closeOnEscape===true){jQuery("#"+g).keydown(function(j){if(j.which==27){d(b("#"+g))}})}}}}function s(v){var e=(v!==undefined),k=jQuery("#"+l.p.id),j=[];if(c.multipleSearch===false){j[c.sField]=v.rules[0].field;j[c.sValue]=v.rules[0].data;j[c.sOper]=v.rules[0].op}else{j[c.sFilter]=v}k[0].p.search=e;k[0].p.searchdata=j;k[0].p.page=1;k.trigger("reloadGrid");if(c.closeAfterSearch){d(b("#"+g))}}function m(v){var e=(v!==undefined),k=jQuery("#"+l.p.id),j=[];k[0].p.search=e;if(c.multipleSearch===false){j[c.sField]=j[c.sValue]=j[c.sOper]=""}else{j[c.sFilter]=""}k[0].p.searchdata=j;k[0].p.page=1;k.trigger("reloadGrid")}function d(e){e.hide();b(".jqgrid-overlay","#gbox_"+l.p.id).hide()}function f(){b("#"+g).show();b(".jqgrid-overlay","#gbox_"+l.p.id).show();try{b(":input:visible","#"+g)[0].focus()}catch(e){}}})},editGridRow:function(c,d){d=b.extend({top:0,left:0,width:300,height:"auto",modal:false,drag:true,resize:true,url:null,mtype:"POST",closeAfterAdd:false,clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:""},b.jgrid.edit,d||{});a=d;return this.each(function(){var y=this;if(!y.grid||!c){return}var q=y.p.id,i={themodal:"editmod"+q,modalhead:"edithd"+q,modalcontent:"editcnt"+q},D=b.isFunction(a.beforeShowForm)?a.beforeShowForm:false,o=b.isFunction(a.afterShowForm)?a.afterShowForm:false,z=b.isFunction(a.beforeInitData)?a.beforeInitData:false,v=b.isFunction(a.onInitializeForm)?a.onInitializeForm:false,A="FrmGrid_"+q,s="TblGrid_"+q,j=null,g=1,f=0;if(c=="new"){c="_empty";d.caption=d.addCaption}else{d.caption=d.editCaption}if(d.recreateForm===true&&b("#"+i.themodal).html()!=null){b("#"+i.themodal).remove()}if(b("#"+i.themodal).html()!=null){b(".ui-jqdialog-title","#"+i.modalhead).html(d.caption);b("#FormError","#"+s).hide();if(z){z(b("#"+A))}l(c,y,A);if(c=="_empty"){b("#pData, #nData","#"+s).hide()}else{b("#pData, #nData","#"+s).show()}if(d.processing===true){d.processing=false;b("#sData","#"+s).attr("disabled",false)}if(D){D(b("#"+A))}viewModal("#"+i.themodal,{gbox:"#gbox_"+q,jqm:d.jqModal});if(o){o(b("#"+A))}}else{b(y.p.colModel).each(function(E){var F=this.formoptions;g=Math.max(g,F?F.colpos||0:0);f=Math.max(f,F?F.rowpos||0:0)});var x,B=b("<form name='FormPost' id='"+A+"' class='FormGrid'></form>"),k=b("<table id='"+s+"' class='EditTable' cellspacing='0' cellpading='0' border='0' width='100%'><tbody></tbody></table>");b(B).append(k);x=b("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(g*2)+"'></td></tr>");x[0].rp=0;b(k).append(x);if(a.topinfo){x=b("<tr><td class='topinfo' colspan='"+(g*2)+"'>"+a.topinfo+"</td></tr>");x[0].rp=0;b(k).append(x)}if(z){z(b("#"+A))}var w=m(c,y,k,g),t="<div id='pData'></div>",u="<div id='nData'></div>",r="<input id='sData' type='button' class='EditButton' value='"+d.bSubmit+"'/>",C="<input id='cData' type='button'  class='EditButton' value='"+d.bCancel+"'/>";x=b("<tr id='Act_Buttons'><td class='navButton ui-widget-content'>"+t+u+"</td><td colspan='"+(g*2-1)+"' class='EditButton ui-widget-content'>"+r+"&nbsp;"+C+"</td></tr>");x[0].rp=900;b(k).append(x);if(a.bottominfo){x=b("<tr><td class='bottominfo' colspan='"+(g*2)+"'>"+a.bottominfo+"</td></tr>");x[0].rp=901;b(k).append(x)}if(f>0){var e=[];b.each(b(k)[0].rows,function(E,F){e[E]=F});e.sort(function(F,E){if(F.rp>E.rp){return 1}if(F.rp<E.rp){return -1}return 0});b.each(e,function(E,F){b("tbody",k).append(F)})}d.gbox="#gbox_"+q;createModal(i,B,d,"#gview_"+y.p.id,b("#gview_"+y.p.id)[0]);if(v){v(b("#"+A))}if(c=="_empty"){b("#pData,#nData","#"+s).hide()}else{b("#pData,#nData","#"+s).show()}if(D){D(b("#"+A))}viewModal("#"+i.themodal,{gbox:"#gbox_"+q,jqm:d.jqModal});if(o){o(b("#"+A))}b("#nData","#"+s).addClass("ui-state-default ui-corner-right").append("<span class='ui-icon ui-icon-triangle-1-e'></span>");b("#pData","#"+s).addClass("ui-state-default ui-corner-left").append("<span class='ui-icon ui-icon-triangle-1-w'></span>");b("#pData, #nData").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#sData, #cData","#"+s).addClass("ui-state-default ui-corner-all").height(21).css({padding:".2em .5em",cursor:"pointer"}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#sData","#"+s).click(function(I){var H={},G=[true,"",""],J={};b("#FormError","#"+s).hide();var F=0;b(".FormElement","#"+s).each(function(M){var L=true;switch(b(this).get(0).type){case"checkbox":if(b(this).attr("checked")){H[this.name]=b(this).val()}else{var K=b(this).attr("offval");H[this.name]=K;J[this.name]=K}break;case"select-one":H[this.name]=b("option:selected",this).val();J[this.name]=b("option:selected",this).text();break;case"select-multiple":H[this.name]=b(this).val();if(H[this.name]){H[this.name]=H[this.name].join(",")}else{H[this.name]=""}var N=[];b("option:selected",this).each(function(O,P){N[O]=b(P).text()});J[this.name]=N.join(",");break;case"password":case"text":case"textarea":case"button":H[this.name]=b(this).val();H[this.name]=!y.p.autoencode?H[this.name]:htmlEncode(H[this.name]);break}G=checkValues(H[this.name],this.name,y);if(G[0]===false){L=false}F++;if(!L){return false}});if(F==0){G[0]=false;G[1]=b.jgrid.errors.norecords}if(b.isFunction(a.onclickSubmit)){a.editData=a.onclickSubmit(d)||{}}if(G[0]){if(b.isFunction(a.beforeSubmit)){G=a.beforeSubmit(H,b("#"+A))}}var E=a.url?a.url:y.p.editurl;if(G[0]){if(!E){G[0]=false;G[1]+=" "+b.jgrid.errors.nourl}}if(G[0]===false){b("#FormError>td","#"+s).html(G[1]);b("#FormError","#"+s).show()}else{if(!d.processing){d.processing=true;b(this).attr("disabled",true);H.oper=H.id=="_empty"?"add":"edit";H=b.extend(H,a.editData);b.ajax({url:E,type:a.mtype,data:H,complete:function(L,K){if(K!="success"){G[0]=false;G[1]=K+" Status: "+L.statusText+" Error code: "+L.status}else{if(b.isFunction(a.afterSubmit)){G=a.afterSubmit(L,H)}}if(G[0]===false){b("#FormError>td","#"+s).html(G[1]);b("#FormError","#"+s).show()}else{H=b.extend(H,J);if(H.id=="_empty"){if(!G[2]){G[2]=parseInt(y.p.records)+1}H.id=G[2];if(a.closeAfterAdd){if(a.reloadAfterSubmit){b(y).trigger("reloadGrid")}else{b(y).addRowData(G[2],H,d.addedrow);b(y).setSelection(G[2])}hideModal("#"+i.themodal,{gb:"#gbox_"+q,jqm:d.jqModal})}else{if(a.clearAfterAdd){if(a.reloadAfterSubmit){b(y).trigger("reloadGrid")}else{b(y).addRowData(G[2],H,d.addedrow)}l("_empty",y,A)}else{if(a.reloadAfterSubmit){b(y).trigger("reloadGrid")}else{b(y).addRowData(G[2],H,d.addedrow)}}}}else{if(a.reloadAfterSubmit){b(y).trigger("reloadGrid");if(!a.closeAfterEdit){b(y).setSelection(H.id)}}else{if(y.p.treeGrid===true){b(y).setTreeRow(H.id,H)}else{b(y).setRowData(H.id,H)}}if(a.closeAfterEdit){hideModal("#"+i.themodal,{gb:"#gbox_"+q,jqm:d.jqModal})}}if(b.isFunction(a.afterComplete)){j=L;setTimeout(function(){a.afterComplete(j,H,b("#"+A));j=null},500)}}d.processing=false;b("#sData","#"+s).attr("disabled",false);try{b(":input:visible","#"+A)[0].focus()}catch(M){}},error:function(M,K,L){b("#FormError>td","#"+s).html(K+" : "+L);b("#FormError","#"+s).show();d.processing=false;b("#sData","#"+s).attr("disabled",false)}})}}return false});b("#cData","#"+s).click(function(E){hideModal("#"+i.themodal,{gb:"#gbox_"+q,jqm:d.jqModal});return false});b("#nData","#"+s).click(function(E){b("#FormError","#"+s).hide();var F=h();F[0]=parseInt(F[0]);if(F[0]!=-1&&F[1][F[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+A),F[1][F[0]])}l(F[1][F[0]+1],y,A);b(y).setSelection(F[1][F[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+A),F[1][F[0]+1])}n(F[0]+1,F[1].length-1)}return false});b("#pData","#"+s).click(function(F){b("#FormError","#"+s).hide();var E=h();if(E[0]!=-1&&E[1][E[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+A),E[1][E[0]])}l(E[1][E[0]-1],y,A);b(y).setSelection(E[1][E[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+A),E[1][E[0]-1])}n(E[0]-1,E[1].length-1)}return false})}var p=h();n(p[0],p[1].length-1);function n(F,G,E){if(F==0){b("#pData","#"+s).addClass("ui-state-disabled")}else{b("#pData","#"+s).removeClass("ui-state-disabled")}if(F==G){b("#nData","#"+s).addClass("ui-state-disabled")}else{b("#nData","#"+s).removeClass("ui-state-disabled")}}function h(){var F=b(y).getDataIDs();var E=b("#id_g","#"+s).val();var G=b.inArray(E,F);return[G,F]}function m(H,N,K,S){var E,F,P,Q=0,U,V,O,T=[],L=false,M,G,I="<td class='CaptionTD ui-widget-content'>&nbsp;</td><td class='DataTD ui-widget-content'>&nbsp;</td>",J="";for(var R=1;R<=S;R++){J+=I}if(H!="_empty"){L=b(N).getInd(N.rows,H)}b(N.p.colModel).each(function(Z){E=this.name;if(this.editrules&&this.editrules.edithidden==true){F=false}else{F=this.hidden===true?true:false}V=F?"style='display:none'":"";if(E!=="cb"&&E!=="subgrid"&&this.editable===true&&E!=="rn"){if(L===false){U=""}else{if(E==N.p.ExpandColumn&&N.p.treeGrid===true){U=b("td:eq("+Z+")",N.rows[L]).text()}else{try{U=b.unformat(b("td:eq("+Z+")",N.rows[L]),{colModel:this},Z)}catch(X){U=b("td:eq("+Z+")",N.rows[L]).html()}}}var Y=b.extend({},this.editoptions||{},{id:E,name:E});frmopt=b.extend({},{elmprefix:"",elmsuffix:""},this.formoptions||{}),M=parseInt(frmopt.rowpos)||Q+1,G=parseInt((parseInt(frmopt.colpos)||1)*2);if(H=="_empty"&&Y.defaultValue){U=b.isFunction(Y.defaultValue)?Y.defaultValue():Y.defaultValue}if(!this.edittype){this.edittype="text"}O=createEl(this.edittype,Y,U);b(O).addClass("FormElement");P=b(K).find("tr[rowpos="+M+"]");if(P.length==0){P=b("<tr "+V+" rowpos='"+M+"'></tr>").addClass("FormData").attr("id","tr_"+E);b(P).append(J);b(K).append(P);P[0].rp=M}b("td:eq("+(G-2)+")",P[0]).html(typeof frmopt.label==="undefined"?N.p.colNames[Z]:frmopt.label);b("td:eq("+(G-1)+")",P[0]).append(frmopt.elmprefix).append(O).append(frmopt.elmsuffix);T[Q]=Z;Q++}});if(Q>0){var W=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(S*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+H+"'/></td></tr>");W[0].rp=Q+999;b(K).append(W)}return T}function l(F,K,G){var N,M,H=0,L,J,E,I;if(F=="_empty"){b(K.p.colModel).each(function(O){N=this.name;E=b.extend({},this.editoptions||{});J=b("#"+N,"#"+G);if(J[0]!=null){if(E.defaultValue){I=b.isFunction(E.defaultValue)?E.defaultValue():E.defaultValue;if(J[0].type=="checkbox"){I=I.toLowerCase();if(I.search(/(false|0|no|off|undefined)/i)<0&&I!==""){J[0].checked=true;J[0].defaultChecked=true;J[0].value=I}else{J.attr({checked:"",defaultChecked:""})}}else{J.val(I)}}else{J.val("")}}});b("#id_g","#"+G).val("_empty");return}b("table:first tr#"+F+" td",K.grid.bDiv).each(function(P){N=K.p.colModel[P].name;if(K.p.colModel[P].editrules&&K.p.colModel[P].editrules.edithidden===true){M=false}else{M=K.p.colModel[P].hidden===true?true:false}if(N!=="cb"&&N!=="subgrid"&&K.p.colModel[P].editable===true){if(N==K.p.ExpandColumn&&K.p.treeGrid===true){L=b(this).text()}else{try{L=b.unformat(this,{colModel:K.p.colModel[P]},P)}catch(O){L=b(this).html()}}N=N.replace(".","\\.");switch(K.p.colModel[P].edittype){case"password":case"text":case"button":case"image":L=b.htmlDecode(L);b("#"+N,"#"+G).val(L);break;case"textarea":if(L=="&nbsp;"||L=="&#160;"||(L.length==1&&L.charCodeAt(0)==160)){L=""}b("#"+N,"#"+G).val(L);break;case"select":L=b.htmlDecode(L);b("#"+N+" option","#"+G).each(function(Q){if(!K.p.colModel[P].editoptions.multiple&&L==b(this).text()){this.selected=true}else{if(K.p.colModel[P].editoptions.multiple){if(b.inArray(b(this).text(),L.split(","))>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}}});break;case"checkbox":L=L.toLowerCase();if(L.search(/(false|0|no|off|undefined)/i)<0&&L!==""){b("#"+N,"#"+G).attr("checked",true);b("#"+N,"#"+G).attr("defaultChecked",true)}else{b("#"+N,"#"+G).attr("checked",false);b("#"+N,"#"+G).attr("defaultChecked","")}break}H++}});if(H>0){b("#id_g","#"+s).val(F)}return H}})},viewGridRow:function(c,d){d=b.extend({top:0,left:0,width:0,height:0,modal:false,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%"},b.jgrid.view,d||{});return this.each(function(){var v=this;if(!v.grid||!c){return}if(!d.imgpath){d.imgpath=v.p.imgpath}var p=v.p.id,i={themodal:"viewmod"+p,modalhead:"viewhd"+p,modalcontent:"viewcnt"+p},g=1,e=0,w="ViewGrid_"+p,q="ViewTbl_"+p;if(b("#"+i.themodal).html()!=null){b(".ui-jqdialog-title","#"+i.modalhead).html(d.caption);b("#FormError","#"+q).hide();l(c,v);viewModal("#"+i.themodal,{gbox:"#gbox_"+p,jqm:d.jqModal});j()}else{b(v.p.colModel).each(function(z){var A=this.formoptions;g=Math.max(g,A?A.colpos||0:0);e=Math.max(e,A?A.rowpos||0:0)});var u,x=b("<form name='FormPost' id='"+w+"' class='FormGrid'></form>"),k=b("<table id='"+q+"' class='EditTable' cellspacing='1' cellpading='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");b(x).append(k);var t=m(c,v,k,g),r="<div id='pData' class='ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></div>",s="<div id='nData' class='ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></div>",y="<input id='cData' type='button'  class='EditButton ui-state-default ui-corner-all' value='"+d.bClose+"'/>";u=b("<tr id='Act_Buttons'><td class='navButton ui-widget-content'>"+r+s+"</td><td colspan='"+(g*2-1)+"'class='EditButton ui-widget-content'>"+y+"</td></tr>");b(k).append(u);u[0].rp=t.length+100;if(e>0){var f=[];b.each(b(k)[0].rows,function(z,A){f[z]=A});f.sort(function(A,z){if(A.rp>z.rp){return 1}if(A.rp<z.rp){return -1}return 0});b.each(f,function(z,A){b("tbody",k).append(A)})}d.gbox="#gbox_"+p;createModal(i,x,d,"#gview_"+v.p.id,b("#gview_"+v.p.id)[0]);viewModal("#"+i.themodal,{gbox:"#gbox_"+p,jqm:d.jqModal});b("#pData, #nData","#"+q).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#cData","#"+q).css({padding:".2em .5em",cursor:"pointer"}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});j();b("#cData","#"+q).click(function(z){hideModal("#"+i.themodal,{gb:"#gbox_"+p,jqm:d.jqModal});z.stopPropagation();return false});b("#nData","#"+q).click(function(z){b("#FormError","#"+q).hide();var A=h();A[0]=parseInt(A[0]);if(A[0]!=-1&&A[1][A[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+w),A[1][A[0]])}l(A[1][A[0]+1],v);b(v).setSelection(A[1][A[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+w),A[1][A[0]+1])}n(A[0]+1,A[1].length-1)}j();return false});b("#pData","#"+q).click(function(A){b("#FormError","#"+q).hide();var z=h();if(z[0]!=-1&&z[1][z[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+w),z[1][z[0]])}l(z[1][z[0]-1],v);b(v).setSelection(z[1][z[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+w),z[1][z[0]-1])}n(z[0]-1,z[1].length-1)}j();return false})}function j(){if(d.closeOnEscape===true){setTimeout(function(){b(".jqmClose","#"+i.modalhead).focus()},0)}}var o=h();n(o[0],o[1].length-1);function n(A,B,z){if(A==0){b("#pData","#"+q).addClass("ui-state-disabled")}else{b("#pData","#"+q).removeClass("ui-state-disabled")}if(A==B){b("#nData","#"+q).addClass("ui-state-disabled")}else{b("#nData","#"+q).removeClass("ui-state-disabled")}}function h(){var A=b(v).getDataIDs();var z=b("#id_g","#"+q).val();var B=b.inArray(z,A);return[B,A]}function m(F,L,J,S){var B,E,N,V,z,Q=0,U,W,M,T=[],K=false,H="<td class='CaptionTD ui-widget-content' width='"+d.labelswidth+"'>&nbsp;</td><td class='DataTD ui-helper-reset ui-widget-content'>&nbsp;</td>",I="",C="<td class='CaptionTD ui-widget-content'>&nbsp;</td><td class='DataTD ui-widget-content'>&nbsp;</td>",G=["integer","number","currency"],P=0,O=0,D,A;for(var R=1;R<=S;R++){I+=R==1?H:C}b(L.p.colModel).each(function(Y){if(this.editrules&&this.editrules.edithidden===true){E=false}else{E=this.hidden===true?true:false}if(!E&&this.align==="right"){if(this.formatter&&b.inArray(this.formatter,G)!==-1){P=Math.max(P,parseInt(this.width,10))}else{O=Math.max(O,parseInt(this.width,10))}}});D=P!==0?P:O!==0?O:0;K=b(L).getInd(L.rows,F);b(L.p.colModel).each(function(Z){B=this.name;A=false;if(this.editrules&&this.editrules.edithidden===true){E=false}else{E=this.hidden===true?true:false}W=E?"style='display:none'":"";if(B!=="cb"&&B!=="subgrid"&&this.editable===true){if(K===false){U=""}else{if(B==L.p.ExpandColumn&&L.p.treeGrid===true){U=b("td:eq("+Z+")",L.rows[K]).text()}else{U=b("td:eq("+Z+")",L.rows[K]).html()}}A=this.align==="right"&&D!==0?true:false;var Y=b.extend({},this.editoptions||{},{id:B,name:B}),ac=b.extend({},{elmprefix:"",elmsuffix:""},this.formoptions||{}),aa=parseInt(ac.rowpos)||Q+1,ab=parseInt((parseInt(ac.colpos)||1)*2);if(!this.edittype){this.edittype="text"}N=b(J).find("tr[rowpos="+aa+"]");if(N.length==0){N=b("<tr "+W+" rowpos='"+aa+"'></tr>").addClass("FormData").attr("id","tr_"+B);b(N).append(I);b(J).append(N);N[0].rp=aa}b("td:eq("+(ab-2)+")",N[0]).html("<b>"+(typeof ac.label==="undefined"?L.p.colNames[Z]:ac.label)+"</b>");b("td:eq("+(ab-1)+")",N[0]).append("<span style='position:absolute;float:left;'>"+U+"</span>").attr("id",B);if(A){b("td:eq("+(ab-1)+") span",N[0]).css({"text-align":"right",width:D+"px"})}T[Q]=Z;Q++}});if(Q>0){var X=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(S*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+F+"'/></td></tr>");X[0].rp=Q+99;b(J).append(X)}return T}function l(D,E){var z,F,C=0,B,A;b("#"+D+" td",E.grid.bDiv).each(function(G){z=E.p.colModel[G].name;if(E.p.colModel[G].editrules&&E.p.colModel[G].editrules.edithidden===true){F=false}else{F=E.p.colModel[G].hidden===true?true:false}if(z!=="cb"&&z!=="subgrid"&&E.p.colModel[G].editable===true){if(z==E.p.ExpandColumn&&E.p.treeGrid===true){B=b(this).text()}else{B=b(this).html()}z=z.replace(".","\\.");A=b.extend({},E.p.colModel[G].editoptions||{});b("#"+z+" span","#"+q).html(B);if(F){b("#"+z,"#"+q).parents("tr:first").hide()}C++}});if(C>0){b("#id_g","#"+q).val(D)}return C}})},delGridRow:function(c,d){d=b.extend({top:0,left:0,width:240,height:"auto",modal:false,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,onclickSubmit:null,jqModal:true,closeOnEscape:false,delData:{}},b.jgrid.del,d||{});a=d;return this.each(function(){var j=this;if(!j.grid){return}if(!c){return}var l=typeof d.beforeShowForm==="function"?true:false,f=typeof d.afterShowForm==="function"?true:false,e=j.p.id,g={themodal:"delmod"+e,modalhead:"delhd"+e,modalcontent:"delcnt"+e},i="DelTbl_"+e;if(isArray(c)){c=c.join()}if(b("#"+g.themodal).html()!=null){b("#DelData>td","#"+i).text(c);b("#DelError","#"+i).hide();if(d.processing===true){d.processing=false;b("#dData","#"+i).attr("disabled",false)}if(l){d.beforeShowForm(b("#"+i))}viewModal("#"+g.themodal,{gbox:"#gbox_"+e,jqm:d.jqModal});if(f){d.afterShowForm(b("#"+i))}}else{var k=b("<table id='"+i+"' class='DelTable'><tbody></tbody></table>");b(k).append("<tr id='DelError' style='display:none'><td >&nbsp;</td></tr>");b(k).append("<tr id='DelData' style='display:none'><td >"+c+"</td></tr>");b(k).append("<tr><td >"+d.msg+"</td></tr>");var h="<input id='dData' type='button' value='"+d.bSubmit+"'/>",m="<input id='eData' type='button' value='"+d.bCancel+"'/>";b(k).append("<tr><td align='right' class='DelButton'>"+h+"&nbsp;"+m+"</td></tr>");d.gbox="#gbox_"+e;createModal(g,k,d,"#gview_"+j.p.id,b("#gview_"+j.p.id)[0]);b("#dData, #eData","#"+i).addClass("ui-state-default ui-corner-all").height(21).css({padding:".2em .5em",cursor:"pointer"}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#dData","#"+i).click(function(q){var o=[true,""];var p=b("#DelData>td","#"+i).text();if(typeof d.onclickSubmit==="function"){d.delData=d.onclickSubmit(d)||{}}if(typeof d.beforeSubmit==="function"){o=d.beforeSubmit(p)}var n=a.url?a.url:j.p.editurl;if(!n){o[0]=false;o[1]+=" "+b.jgrid.errors.nourl}if(o[0]===false){b("#DelError>td","#"+i).html(o[1]);b("#DelError","#"+i).show()}else{if(!d.processing){d.processing=true;b(this).attr("disabled",true);var r=b.extend({oper:"del",id:p},d.delData);b.ajax({url:n,type:d.mtype,data:r,complete:function(v,t){if(t!="success"){o[0]=false;o[1]=t+" Status: "+v.statusText+" Error code: "+v.status}else{if(typeof a.afterSubmit==="function"){o=a.afterSubmit(v,p)}}if(o[0]===false){b("#DelError>td","#"+i).html(o[1]);b("#DelError","#"+i).show()}else{if(a.reloadAfterSubmit){if(j.p.treeGrid){b(j).setGridParam({treeANode:0,datatype:j.p.treedatatype})}b(j).trigger("reloadGrid")}else{var s=[];s=p.split(",");if(j.p.treeGrid===true){try{b(j).delTreeNode(s[0])}catch(w){}}else{for(var u=0;u<s.length;u++){b(j).delRowData(s[u])}}j.p.selrow=null;j.p.selarrrow=[]}if(b.isFunction(a.afterComplete)){setTimeout(function(){a.afterComplete(v,p)},500)}}d.processing=false;b("#dData","#"+i).attr("disabled",false);if(o[0]){hideModal("#"+g.themodal,{gb:"#gbox_"+e,jqm:d.jqModal})}},error:function(u,s,t){b("#DelError>td","#"+i).html(s+" : "+t);b("#DelError","#"+i).show();d.processing=false;b("#dData","#"+i).attr("disabled",false)}})}}return false});b("#eData","#"+i).click(function(n){hideModal("#"+g.themodal,{gb:"#gbox_"+e,jqm:d.jqModal});return false});if(l){d.beforeShowForm(b("#"+i))}viewModal("#"+g.themodal,{gbox:"#gbox_"+e,jqm:d.jqModal});if(f){d.afterShowForm(b("#"+i))}}})},navGrid:function(f,h,e,g,d,c,i){h=b.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true},b.jgrid.nav,h||{});return this.each(function(){var j={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},n=this,m,s,o,k;if(!n.grid){return}if(b("#"+j.themodal).html()==null){if(typeof window.innerWidth!="undefined"){m=window.innerWidth,s=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){m=document.documentElement.clientWidth,s=document.documentElement.clientHeight}else{m=1024;s=768}}createModal(j,"<div>"+h.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+n.p.id,jqModal:true,drag:true,resize:true,caption:h.alertcap,top:s/2-25,left:m/2-100,width:200,height:"auto",closeOnEscape:h.closeOnEscape},n.grid.hDiv,n.grid.hDiv,true)}var p,q=b("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),r="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",l=b(n.p.pager).attr("id")||"pager";if(h.add){g=g||{};p=b("<td class='ui-pg-button ui-corner-all'></td>");b(p).append("<div class='ui-pg-div'><span class='ui-icon "+h.addicon+"'></span>"+h.addtext+"</div>");b("tr",q).append(p);b(p,q).attr({title:h.addtitle||"",id:g.id||"add_"+n.p.id}).click(function(){if(typeof h.addfunc=="function"){h.addfunc()}else{b(n).editGridRow("new",g)}return false}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});p=null}if(h.edit){p=b("<td class='ui-pg-button ui-corner-all'></td>");e=e||{};b(p).append("<div class='ui-pg-div'><span class='ui-icon "+h.editicon+"'></span>"+h.edittext+"</div>");b("tr",q).append(p);b(p,q).attr({title:h.edittitle||"",id:e.id||"edit_"+n.p.id}).click(function(){var t=n.p.selrow;if(t){if(typeof h.editfunc=="function"){h.editfunc(t)}else{b(n).editGridRow(t,e)}}else{viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}return false}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});p=null}if(h.view){p=b("<td class='ui-pg-button ui-corner-all'></td>");i=i||{};b(p).append("<div class='ui-pg-div'><span class='ui-icon "+h.viewicon+"'></span>"+h.viewtext+"</div>");b("tr",q).append(p);b(p,q).attr({title:h.viewtitle||"",id:i.id||"view_"+n.p.id}).click(function(){var t=n.p.selrow;if(t){b(n).viewGridRow(t,i)}else{viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}return false}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});p=null}if(h.del){p=b("<td class='ui-pg-button ui-corner-all'></td>");d=d||{};b(p).append("<div class='ui-pg-div'><span class='ui-icon "+h.delicon+"'></span>"+h.deltext+"</div>");b("tr",q).append(p);b(p,q).attr({title:h.deltitle||"",id:d.id||"del_"+n.p.id}).click(function(){var t;if(n.p.multiselect){t=n.p.selarrrow;if(t.length==0){t=null}}else{t=n.p.selrow}if(t){b(n).delGridRow(t,d)}else{viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}return false}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});p=null}if(h.add||h.edit||h.del||h.view){b("tr",q).append(r)}if(h.search){p=b("<td class='ui-pg-button ui-corner-all'></td>");c=c||{};b(p).append("<div class='ui-pg-div'><span class='ui-icon "+h.searchicon+"'></span>"+h.searchtext+"</div>");b("tr",q).append(p);b(p,q).attr({title:h.searchtitle||"",id:c.id||"search_"+n.p.id}).click(function(){b(n).searchGrid(c);return false}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});p=null}if(h.refresh){p=b("<td class='ui-pg-button ui-corner-all'></td>");b(p).append("<div class='ui-pg-div'><span class='ui-icon "+h.refreshicon+"'></span>"+h.refreshtext+"</div>");b("tr",q).append(p);b(p,q).attr({title:h.refreshtitle||"",id:"refresh_"+n.p.id}).click(function(){n.p.search=false;switch(h.refreshstate){case"firstpage":n.p.page=1;b(n).trigger("reloadGrid");break;case"current":var t=n.p.multiselect===true?n.p.selarrrow:n.p.selrow;b(n).trigger("reloadGrid");setTimeout(function(){if(n.p.multiselect===true){if(t.length>0){for(var v=0;v<t.length;v++){b(n).setSelection(t[v],false)}}}else{if(t){b(n).setSelection(t,false)}}},1000);break}if(h.search){var u=n.p.id;b("#fbox_"+u).searchFilter().reset()}return false}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});p=null}k=b(".ui-jqgrid").css("font-size")||"11px";b("body").append("<div id='testpg' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+k+";visibility:hidden;' ></div>");o=b(q).clone(false).appendTo("#testpg").width();b("#testpg").remove();b("#"+l+"_"+h.position,"#"+l).append(q);if(n.p._nvtd){if(o>n.p._nvtd[0]){b("#"+l+"_"+h.position,"#"+l).width(o);n.p._nvtd[0]=o}n.p._nvtd[1]=o}})},navButtonAdd:function(c,d){d=b.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last"},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!=0){c="#"+c}var e=b(".navtable",c)[0];if(e){var f=b("<td></td>");b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+d.buttonicon+"'></span>"+d.caption+"</div>");if(d.id){b(f).attr("id",d.id)}if(d.position=="first"){if(e.rows[0].cells.length===0){b("tr",e).append(f)}else{b("tr td:eq(0)",e).before(f)}}else{b("tr",e).append(f)}b(f,e).attr("title",d.title||"").click(function(g){if(b.isFunction(d.onClickButton)){d.onClickButton()}return false}).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")})}})},GridToForm:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var f=b(g).getRowData(c);if(f){for(var e in f){if(b("[name="+e+"]",d).is("input:radio")){b("[name="+e+"]",d).each(function(){if(b(this).val()==f[e]){b(this).attr("checked","checked")}else{b(this).attr("checked","")}})}else{b("[name="+e+"]",d).val(f[e])}}}})},FormToGrid:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var e=b(d).serializeArray();var f={};b.each(e,function(h,j){f[j.name]=j.value});b(g).setRowData(c,f)})}})})(jQuery);jQuery.fn.searchFilter=function(a,c){function b(j,p,g){this.$=j;this.add=function(z){if(z==null){j.find(".ui-add-last").click()}else{j.find(".sf:eq("+z+") .ui-add").click()}return this};this.del=function(z){if(z==null){j.find(".sf:last .ui-del").click()}else{j.find(".sf:eq("+z+") .ui-del").click()}return this};this.search=function(z){j.find(".ui-search").click();return this};this.reset=function(z){j.find(".ui-reset").click();return this};this.close=function(){j.find(".ui-closer").click();return this};if(p!=null){function v(){jQuery(this).toggleClass("ui-state-hover");return false}function i(z){jQuery(this).toggleClass("ui-state-active",(z.type=="mousedown"));return false}function e(z,A){return"<option value='"+z+"'>"+A+"</option>"}function s(B,z,A){return"<select class='"+B+"'"+(A?" style='display:none;'":"")+">"+z+"</select>"}function w(z,B){var A=j.find("tr.sf td.data "+z);if(A[0]!=null){B(A)}}function q(z,B){var A=j.find("tr.sf td.data "+z);if(A[0]!=null){jQuery.each(B,function(){if(this.data!=null){A.bind(this.type,this.data,this.fn)}else{A.bind(this.type,this.fn)}})}}var n=jQuery.extend({},jQuery.fn.searchFilter.defaults,g);var y=-1;var x="";jQuery.each(n.groupOps,function(){x+=e(this.op,this.text)});x="<select name='groupOp'>"+x+"</select>";j.html("").addClass("ui-searchFilter").append("<div class='ui-widget-overlay' style='z-index: -1'>&nbsp;</div><table class='ui-widget-content ui-corner-all'><thead><tr><td colspan='5' class='ui-widget-header ui-corner-all' style='line-height: 18px;'><div class='ui-closer ui-state-default ui-corner-all ui-helper-clearfix' style='float: right;'><span class='ui-icon ui-icon-close'></span></div>"+n.windowTitle+"</td></tr></thead><tbody><tr class='sf'><td class='fields'></td><td class='ops'></td><td class='data'></td><td><div class='ui-del ui-state-default ui-corner-all'><span class='ui-icon ui-icon-minus'></span></div></td><td><div class='ui-add ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plus'></span></div></td></tr><tr><td colspan='5' class='divider'><div>&nbsp;</div></td></tr></tbody><tfoot><tr><td colspan='3'><span class='ui-reset ui-state-default ui-corner-all' style='display: inline-block; float: left;'><span class='ui-icon ui-icon-arrowreturnthick-1-w' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+n.resetText+"</span></span><span class='ui-search ui-state-default ui-corner-all' style='display: inline-block; float: right;'><span class='ui-icon ui-icon-search' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+n.searchText+"</span></span><span class='matchText'>"+n.matchText+"</span> "+x+" <span class='rulesText'>"+n.rulesText+"</span></td><td>&nbsp;</td><td><div class='ui-add-last ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plusthick'></span></div></td></tr></tfoot></table>");var k=j.find("tr.sf");var h=k.find("td.fields");var f=k.find("td.ops");var o=k.find("td.data");var r="";jQuery.each(n.operators,function(){r+=e(this.op,this.text)});r=s("default",r,true);f.append(r);var l="<input type='text' class='default' style='display:none;' />";o.append(l);var u="";var t=false;var d=false;jQuery.each(p,function(B){var A=B;u+=e(this.value,this.text);if(this.ops!=null){t=true;var z="";jQuery.each(this.ops,function(){z+=e(this.op,this.text)});z=s("field"+A,z,true);f.append(z)}if(this.dataUrl!=null){if(B>y){y=B}d=true;var E=this.dataEvents;var C=this.dataInit;jQuery.get(this.dataUrl,function(G){var F=jQuery("<div />").append(G);F.find("select").addClass("field"+A).hide();o.append(F.html());if(C){w(".field"+B,C)}if(E){q(".field"+B,E)}if(B==y){j.find("tr.sf td.fields select[name='field']").change()}})}else{if(this.dataValues!=null){d=true;var D="";jQuery.each(this.dataValues,function(){D+=e(this.value,this.text)});D=s("field"+A,D,true);o.append(D)}else{if(this.dataEvents!=null||this.dataInit!=null){d=true;var D="<input type='text' class='field"+A+"' />";o.append(D)}}}if(this.dataInit!=null&&B!=y){w(".field"+B,this.dataInit)}if(this.dataEvents!=null&&B!=y){q(".field"+B,this.dataEvents)}});u="<select name='field'>"+u+"</select>";h.append(u);var m=h.find("select[name='field']");if(t){m.change(function(B){var A=B.target.selectedIndex;var C=jQuery(B.target).parents("tr.sf").find("td.ops");C.find("select").removeAttr("name").hide();var z=C.find(".field"+A);if(z[0]==null){z=C.find(".default")}z.attr("name","op").show()})}else{f.find(".default").attr("name","op").show()}if(d){m.change(function(B){var A=B.target.selectedIndex;var C=jQuery(B.target).parents("tr.sf").find("td.data");C.find("select,input").removeAttr("name").hide();var z=C.find(".field"+A);if(z[0]==null){z=C.find(".default")}z.attr("name","data").show()})}else{o.find(".default").attr("name","data").show()}if(t||d){m.change()}j.find(".ui-state-default").hover(v,v).mousedown(i).mouseup(i);j.find(".ui-closer").click(function(z){n.onClose(jQuery(j.selector));return false});j.find(".ui-del").click(function(z){var A=jQuery(z.target).parents(".sf");if(A.siblings(".sf").length>0){if(n.datepickerFix){A.find(".hasDatepicker").datepicker("destroy")}A.remove()}else{A.find("select[name='field']")[0].selectedIndex=0;A.find("select[name='op']")[0].selectedIndex=0;A.find(".data input").val("");A.find(".data select").each(function(){this.selectedIndex=0});A.find("select[name='field']").change()}return false});j.find(".ui-add").click(function(C){var D=jQuery(C.target).parents(".sf");var B=D.clone(true).insertAfter(D);B.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");if(n.clone){B.find("select[name='field']")[0].selectedIndex=D.find("select[name='field']")[0].selectedIndex;var A=(B.find("select[name='op']")[0]==null);if(!A){B.find("select[name='op']").focus()[0].selectedIndex=D.find("select[name='op']")[0].selectedIndex}var z=B.find("select[name='data']");if(z[0]!=null){z[0].selectedIndex=D.find("select[name='data']")[0].selectedIndex}}else{B.find(".data input").val("");B.find("select[name='field']").focus()}if(n.datepickerFix===true){D.find(".hasDatepicker").each(function(){var E=jQuery.data(this,"datepicker").settings;B.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(E)})}B.find("select[name='field']").change();return false});j.find(".ui-search").click(function(C){var B=jQuery(j.selector);var z;var A=B.find("select[name='groupOp'] :selected").val();if(!n.stringResult){z={groupOp:A,rules:[]}}else{z='{"groupOp":"'+A+'","rules":['}B.find(".sf").each(function(D){var G=jQuery(this).find("select[name='field'] :selected").val();var F=jQuery(this).find("select[name='op'] :selected").val();var E=jQuery(this).find("input[name='data'],select[name='data'] :selected").val();if(!n.stringResult){z.rules.push({field:G,op:F,data:E})}else{if(D>0){z+=","}z+='{"field":"'+G+'",';z+='"op":"'+F+'",';z+='"data":"'+E+'"}'}});if(n.stringResult){z+="]}"}n.onSearch(z);return false});j.find(".ui-reset").click(function(A){var z=jQuery(j.selector);z.find(".ui-del").click();z.find("select[name='groupOp']")[0].selectedIndex=0;n.onReset();return false});j.find(".ui-add-last").click(function(){var A=jQuery(j.selector+" .sf:last");var z=A.clone(true).insertAfter(A);z.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");z.find(".data input").val("");z.find("select[name='field']").focus();if(n.datepickerFix===true){A.find(".hasDatepicker").each(function(){var B=jQuery.data(this,"datepicker").settings;z.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(B)})}z.find("select[name='field']").change();return false})}}return new b(this,a,c)};jQuery.fn.searchFilter.version="1.2.7";jQuery.fn.searchFilter.defaults={clone:true,datepickerFix:true,onReset:function(a){alert("Reset Clicked. Data Returned: "+a)},onSearch:function(a){alert("Search Clicked. Data Returned: "+a)},onClose:function(a){a.hide()},groupOps:[{op:"AND",text:"all"},{op:"OR",text:"any"}],operators:[{op:"eq",text:"is equal to"},{op:"ne",text:"is not equal to"},{op:"lt",text:"is less than"},{op:"le",text:"is less or equal to"},{op:"gt",text:"is greater than"},{op:"ge",text:"is greater or equal to"},{op:"in",text:"is in"},{op:"ni",text:"is not in"},{op:"bw",text:"begins with"},{op:"bn",text:"does not begin with"},{op:"ew",text:"ends with"},{op:"en",text:"does not end with"},{op:"cn",text:"contains"},{op:"nc",text:"does not contain"}],matchText:"match",rulesText:"rules",resetText:"Reset",searchText:"Search",stringResult:true,windowTitle:"Search Rules"};(function(a){a.fn.extend({editRow:function(c,i,h,j,b,e,d,f,g){return this.each(function(){var n=this,t,o,l,m=0,s=null,r=[],k,q;if(!n.grid){return}var p;if(!n.p.multiselect){k=a(n).getInd(n.rows,c);if(k===false){return}l=a(n.rows[k]).attr("editable")||"0";if(l=="0"){q=n.p.colModel;a("td",n.rows[k]).each(function(w){t=q[w].name;p=q[w].hidden===true?true:false;try{o=a.unformat(this,{colModel:q[w]},w)}catch(u){o=a(this).html()}r[t]=o;if(t!=="cb"&&t!=="subgrid"&&q[w].editable===true&&!p&&t!="rn"){if(s===null){s=w}a(this).html("");var v=a.extend({},q[w].editoptions||{},{id:c+"_"+t,name:t});if(!q[w].edittype){q[w].edittype="text"}var x=createEl(q[w].edittype,v,o,a(this));a(x).addClass("editable");a(this).append(x);if(q[w].edittype=="select"&&q[w].editoptions.multiple===true&&a.browser.msie){a(x).width(a(x).width())}m++}});if(m>0){r.id=c;n.p.savedRow.push(r);a(n.rows[k]).attr("editable","1");a("td:eq("+s+") input",n.rows[k]).focus();if(i===true){a(n.rows[k]).bind("keydown",function(u){if(u.keyCode===27){a(n).restoreRow(c,g)}if(u.keyCode===13){a(n).saveRow(c,j,b,e,d,f);return false}u.stopPropagation()})}if(a.isFunction(h)){h(c)}}}}})},saveRow:function(h,g,e,f,d,c,b){return this.each(function(){var o=this,t,p={},l={},j,r,q,i;if(!o.grid){return}i=a(o).getInd(o.rows,h);if(i===false){return}j=a(o.rows[i]).attr("editable");e=e?e:o.p.editurl;if(j==="1"&&e){a("td",o.rows[i]).each(function(u){t=o.p.colModel[u].name;if(t!=="cb"&&t!=="subgrid"&&o.p.colModel[u].editable===true){if(o.p.colModel[u].hidden===true){p[t]=a(this).html()}else{switch(o.p.colModel[u].edittype){case"checkbox":var k=["Yes","No"];if(o.p.colModel[u].editoptions){k=o.p.colModel[u].editoptions.value.split(":")}p[t]=a("input",this).attr("checked")?k[0]:k[1];break;case"text":case"password":case"textarea":case"button":p[t]=!o.p.autoencode?a("input, textarea",this).val():htmlEncode(a("input, textarea",this).val());break;case"select":if(!o.p.colModel[u].editoptions.multiple){p[t]=a("select>option:selected",this).val();l[t]=a("select>option:selected",this).text()}else{var v=a("select",this),w=[];p[t]=a(v).val();if(p[t]){p[t]=p[t].join(",")}else{p[t]=""}a("select > option:selected",this).each(function(x,y){w[x]=a(y).text()});l[t]=w.join(",")}break}q=checkValues(p[t],u,o);if(q[0]===false){q[1]=p[t]+" "+q[1];return false}}}});if(q[0]===false){try{info_dialog(a.jgrid.errors.errcap,q[1],a.jgrid.edit.bClose,o.p.imgpath)}catch(s){alert(q[1])}return}if(p){p.id=h;if(f){p=a.extend({},p,f)}}if(!o.grid.hDiv.loading){o.grid.hDiv.loading=true;a("div.loading",o.grid.hDiv).fadeIn("fast");if(e=="clientArray"){p=a.extend({},p,l);var n=a(o).setRowData(h,p);a(o.rows[i]).attr("editable","0");for(var m=0;m<o.p.savedRow.length;m++){if(o.p.savedRow[m].id===h){r=m;break}}if(r>=0){o.p.savedRow.splice(r,1)}if(a.isFunction(d)){d(h,n)}}else{a.ajax({url:e,data:p,type:"POST",complete:function(w,x){if(x==="success"){var v;if(a.isFunction(g)){v=g(w)}else{v=true}if(v===true){p=a.extend({},p,l);a(o).setRowData(h,p);a(o.rows[i]).attr("editable","0");for(var u=0;u<o.p.savedRow.length;u++){if(o.p.savedRow[u].id===h){r=u;break}}if(r>=0){o.p.savedRow.splice(r,1)}if(a.isFunction(d)){d(h,w.responseText)}}else{a(o).restoreRow(h,b)}}},error:function(k,u){if(a.isFunction(c)){c(k,u)}else{alert("Error Row: "+h+" Result: "+k.status+":"+k.statusText+" Status: "+u)}}})}o.grid.hDiv.loading=false;a("div.loading",o.grid.hDiv).fadeOut("fast");a(o.rows[i]).unbind("keydown")}}})},restoreRow:function(c,b){return this.each(function(){var g=this,d,f;if(!g.grid){return}f=a(g).getInd(g.rows,c);if(f===false){return}for(var e=0;e<g.p.savedRow.length;e++){if(g.p.savedRow[e].id===c){d=e;break}}if(d>=0){a(g).setRowData(c,g.p.savedRow[d]);a(g.rows[f]).attr("editable","0");g.p.savedRow.splice(d,1)}if(a.isFunction(b)){b(c)}})}})})(jQuery);(function(a){a.fn.extend({editCell:function(d,c,b){return this.each(function(){var j=this,m,k,g;if(!j.grid||j.p.cellEdit!==true){return}c=parseInt(c,10);j.p.selrow=j.rows[d].id;if(!j.p.knv){a(j).GridNav()}if(j.p.savedRow.length>0){if(b===true){if(d==j.p.iRow&&c==j.p.iCol){return}}var h=a("td:eq("+j.p.savedRow[0].ic+")>#"+j.p.savedRow[0].id+"_"+j.p.savedRow[0].name.replace(".","\\."),j.rows[j.p.savedRow[0].id]).val();if(j.p.savedRow[0].v!=h){a(j).saveCell(j.p.savedRow[0].id,j.p.savedRow[0].ic)}else{a(j).restoreCell(j.p.savedRow[0].id,j.p.savedRow[0].ic)}}else{window.setTimeout(function(){a("#"+j.p.knv).attr("tabindex","-1").focus()},0)}m=j.p.colModel[c].name;if(m=="subgrid"){return}if(j.p.colModel[c].editable===true&&b===true){g=a("td:eq("+c+")",j.rows[d]);if(parseInt(j.p.iCol)>=0&&parseInt(j.p.iRow)>=0){a("td:eq("+j.p.iCol+")",j.rows[j.p.iRow]).removeClass("edit-cell ui-state-highlight");a(j.rows[j.p.iRow]).removeClass("selected-row ui-state-hover")}a(g).addClass("edit-cell ui-state-highlight");a(j.rows[d]).addClass("selected-row ui-state-hover");try{k=a.unformat(g,{colModel:j.p.colModel[c]},c)}catch(l){k=a(g).html()}var f=a.extend({},j.p.colModel[c].editoptions||{},{id:d+"_"+m,name:m});if(!j.p.colModel[c].edittype){j.p.colModel[c].edittype="text"}j.p.savedRow[0]={id:d,ic:c,name:m,v:k};if(a.isFunction(j.p.formatCell)){var i=j.p.formatCell(j.rows[d].id,m,k,d,c);if(i){k=i}}var e=createEl(j.p.colModel[c].edittype,f,k,g);if(a.isFunction(j.p.beforeEditCell)){j.p.beforeEditCell(j.rows[d].id,m,k,d,c)}a(g).html("").append(e).attr("tabindex","0");window.setTimeout(function(){a(e).focus()},0);a("input, select, textarea",g).bind("keydown",function(n){if(n.keyCode===27){a(j).restoreCell(d,c)}if(n.keyCode===13){a(j).saveCell(d,c)}if(n.keyCode==9){if(n.shiftKey){a(j).prevCell(d,c)}else{a(j).nextCell(d,c)}}n.stopPropagation()});if(a.isFunction(j.p.afterEditCell)){j.p.afterEditCell(j.rows[d].id,m,k,d,c)}}else{if(parseInt(j.p.iCol)>=0&&parseInt(j.p.iRow)>=0){a("td:eq("+j.p.iCol+")",j.rows[j.p.iRow]).removeClass("edit-cell ui-state-highlight");a(j.rows[j.p.iRow]).removeClass("selected-row ui-state-hover")}a("td:eq("+c+")",j.rows[d]).addClass("edit-cell ui-state-highlight");a(j.rows[d]).addClass("selected-row ui-state-hover");if(a.isFunction(j.p.onSelectCell)){k=a("td:eq("+c+")",j.rows[d]).html().replace(/\&nbsp\;/ig,"");j.p.onSelectCell(j.rows[d].id,m,k,d,c)}}j.p.iCol=c;j.p.iRow=d})},saveCell:function(c,b){return this.each(function(){var j=this,l;if(!j.grid||j.p.cellEdit!==true){return}if(j.p.savedRow.length==1){l=0}else{l=null}if(l!=null){var g=a("td:eq("+b+")",j.rows[c]),q,o,r=j.p.colModel[b].name.replace(".","\\.");switch(j.p.colModel[b].edittype){case"select":if(!j.p.colModel[b].editoptions.multiple){q=a("#"+c+"_"+r.replace(".","\\.")+">option:selected",j.rows[c]).val();o=a("#"+c+"_"+r.replace(".","\\.")+">option:selected",j.rows[c]).text()}else{var d=a("#"+c+"_"+r.replace(".","\\."),j.rows[c]),f=[];q=a(d).val();if(q){q.join(",")}else{q=""}a("option:selected",d).each(function(e,s){f[e]=a(s).text()});o=f.join(",")}break;case"checkbox":var h=["Yes","No"];if(j.p.colModel[b].editoptions){h=j.p.colModel[b].editoptions.value.split(":")}q=a("#"+c+"_"+r.replace(".","\\."),j.rows[c]).attr("checked")?h[0]:h[1];o=q;break;case"password":case"text":case"textarea":case"button":q=!j.p.autoencode?a("#"+c+"_"+r.replace(".","\\."),j.rows[c]).val():htmlEncode(a("#"+c+"_"+r.replace(".","\\."),j.rows[c]).val());o=q;break}if(o!=j.p.savedRow[l].v){if(a.isFunction(j.p.beforeSaveCell)){var p=j.p.beforeSaveCell(j.rows[c].id,r,q,c,b);if(p){q=p}}var i=checkValues(q,b,j);if(i[0]===true){var k={};if(a.isFunction(j.p.beforeSubmitCell)){k=j.p.beforeSubmitCell(j.rows[c].id,r,q,c,b);if(!k){k={}}}if(j.p.cellsubmit=="remote"){if(j.p.cellurl){var n={};n[r]=q;n.id=j.rows[c].id;n=a.extend(k,n);a.ajax({url:j.p.cellurl,data:n,type:"POST",complete:function(e,t){if(t=="success"){if(a.isFunction(j.p.afterSubmitCell)){var s=j.p.afterSubmitCell(e,n.id,r,q,c,b);if(s[0]===true){a(g).empty();a(j).setCell(j.rows[c].id,b,o);a(g).addClass("dirty-cell");a(j.rows[c]).addClass("edited");if(a.isFunction(j.p.afterSaveCell)){j.p.afterSaveCell(j.rows[c].id,r,q,c,b)}j.p.savedRow=[]}else{info_dialog(a.jgrid.errors.errcap,s[1],a.jgrid.edit.bClose,j.p.imgpath);a(j).restoreCell(c,b)}}else{a(g).empty();a(j).setCell(j.rows[c].id,b,o);a(g).addClass("dirty-cell");a(j.rows[c]).addClass("edited");if(a.isFunction(j.p.afterSaveCell)){j.p.afterSaveCell(j.rows[c].id,r,q,c,b)}j.p.savedRow=[]}}},error:function(e,s){if(a.isFunction(j.p.errorCell)){j.p.errorCell(e,s);a(j).restoreCell(c,b)}else{info_dialog(a.jgrid.errors.errcap,e.status+" : "+e.statusText+"<br/>"+s,a.jgrid.edit.bClose,j.p.imgpath);a(j).restoreCell(c,b)}}})}else{try{info_dialog(a.jgrid.errors.errcap,a.jgrid.errors.nourl,a.jgrid.edit.bClose,j.p.imgpath);a(j).restoreCell(c,b)}catch(m){}}}if(j.p.cellsubmit=="clientArray"){a(g).empty();a(j).setCell(j.rows[c].id,b,o);a(g).addClass("dirty-cell");a(j.rows[c]).addClass("edited");if(a.isFunction(j.p.afterSaveCell)){j.p.afterSaveCell(j.rows[c].id,r,q,c,b)}j.p.savedRow=[]}}else{try{window.setTimeout(function(){info_dialog(a.jgrid.errors.errcap,q+" "+i[1],a.jgrid.edit.bClose,j.p.imgpath)},100);a(j).restoreCell(c,b)}catch(m){}}}else{a(j).restoreCell(c,b)}}if(a.browser.opera){a("#"+j.p.knv).attr("tabindex","-1").focus()}else{window.setTimeout(function(){a("#"+j.p.knv).attr("tabindex","-1").focus()},0)}})},restoreCell:function(c,b){return this.each(function(){var h=this,d;if(!h.grid||h.p.cellEdit!==true){return}if(h.p.savedRow.length==1){d=0}else{d=null}if(d!=null){var g=a("td:eq("+b+")",h.rows[c]);if(a.isFunction(a.fn.datepicker)){try{a.datepicker("hide")}catch(f){try{a.datepicker.hideDatepicker()}catch(f){}}}a(g).empty().attr("tabindex","-1");a(h).setCell(h.rows[c].id,b,h.p.savedRow[d].v);h.p.savedRow=[]}window.setTimeout(function(){a("#"+h.p.knv).attr("tabindex","-1").focus()},0)})},nextCell:function(c,b){return this.each(function(){var f=this,e=false;if(!f.grid||f.p.cellEdit!==true){return}for(var d=b+1;d<f.p.colModel.length;d++){if(f.p.colModel[d].editable===true){e=d;break}}if(e!==false){a(f).saveCell(c,b);a(f).editCell(c,e,true)}else{if(f.p.savedRow.length>0){a(f).saveCell(c,b)}}})},prevCell:function(c,b){return this.each(function(){var f=this,e=false;if(!f.grid||f.p.cellEdit!==true){return}for(var d=b-1;d>=0;d--){if(f.p.colModel[d].editable===true){e=d;break}}if(e!==false){a(f).saveCell(c,b);a(f).editCell(c,e,true)}else{if(f.p.savedRow.length>0){a(f).saveCell(c,b)}}})},GridNav:function(){return this.each(function(){var f=this;if(!f.grid||f.p.cellEdit!==true){return}f.p.knv=a("table:first",f.grid.bDiv).attr("id")+"_kn";var e=a("<span style='width:0px;height:0px;background-color:black;' tabindex='0'><span tabindex='-1' style='width:0px;height:0px;background-color:grey' id='"+f.p.knv+"'></span></span>"),c;a(e).insertBefore(f.grid.cDiv);a("#"+f.p.knv).focus();a("#"+f.p.knv).keydown(function(g){switch(g.keyCode){case 38:if(f.p.iRow-1>=0){d(f.p.iRow-1,f.p.iCol,"vu");a(f).editCell(f.p.iRow-1,f.p.iCol,false)}break;case 40:if(f.p.iRow+1<=f.rows.length-1){d(f.p.iRow+1,f.p.iCol,"vd");a(f).editCell(f.p.iRow+1,f.p.iCol,false)}break;case 37:if(f.p.iCol-1>=0){c=b(f.p.iCol-1,"lft");d(f.p.iRow,c,"h");a(f).editCell(f.p.iRow,c,false)}break;case 39:if(f.p.iCol+1<=f.p.colModel.length-1){c=b(f.p.iCol+1,"rgt");d(f.p.iRow,c,"h");a(f).editCell(f.p.iRow,c,false)}break;case 13:if(parseInt(f.p.iCol,10)>=0&&parseInt(f.p.iRow,10)>=0){a(f).editCell(f.p.iRow,f.p.iCol,true)}break}return false});function d(o,m,n){if(n.substr(0,1)=="v"){var g=a(f.grid.bDiv)[0].clientHeight,p=a(f.grid.bDiv)[0].scrollTop,q=f.rows[o].offsetTop+f.rows[o].clientHeight,k=f.rows[o].offsetTop;if(n=="vd"){if(q>=g){a(f.grid.bDiv)[0].scrollTop=a(f.grid.bDiv)[0].scrollTop+f.rows[o].clientHeight}}if(n=="vu"){if(k<p){a(f.grid.bDiv)[0].scrollTop=a(f.grid.bDiv)[0].scrollTop-f.rows[o].clientHeight}}}if(n=="h"){var j=a(f.grid.bDiv)[0].clientWidth,i=a(f.grid.bDiv)[0].scrollLeft,h=f.rows[o].cells[m].offsetLeft+f.rows[o].cells[m].clientWidth,l=f.rows[o].cells[m].offsetLeft;if(h>=j+parseInt(i)){a(f.grid.bDiv)[0].scrollLeft=a(f.grid.bDiv)[0].scrollLeft+f.rows[o].cells[m].clientWidth}else{if(l<i){a(f.grid.bDiv)[0].scrollLeft=a(f.grid.bDiv)[0].scrollLeft-f.rows[o].cells[m].clientWidth}}}}function b(k,g){var j,h;if(g=="lft"){j=k+1;for(h=k;h>=0;h--){if(f.p.colModel[h].hidden!==true){j=h;break}}}if(g=="rgt"){j=k-1;for(h=k;h<f.p.colModel.length;h++){if(f.p.colModel[h].hidden!==true){j=h;break}}}return j}})},getChangedCells:function(c){var b=[];if(!c){c="all"}this.each(function(){var e=this,d;if(!e.grid||e.p.cellEdit!==true){return}a(e.rows).each(function(f){var g={};if(a(this).hasClass("edited")){a("td",this).each(function(h){d=e.p.colModel[h].name;if(d!=="cb"&&d!=="subgrid"){if(c=="dirty"){if(a(this).hasClass("dirty-cell")){g[d]=a.htmlDecode(a(this).html())}}else{g[d]=a.htmlDecode(a(this).html())}}});g.id=this.id;b.push(g)}})});return b}})})(jQuery);(function(d){d.fn.jqm=function(f){var e={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:o,ajaxText:"",target:o,modal:o,toTop:o,onShow:o,onHide:o,onLoad:o};return this.each(function(){if(this._jqm){return n[this._jqm].c=d.extend({},n[this._jqm].c,f)}p++;this._jqm=p;n[p]={c:d.extend(e,d.jqm.params,f),a:o,w:d(this).addClass("jqmID"+p),s:p};if(e.trigger){d(this).jqmAddTrigger(e.trigger)}})};d.fn.jqmAddClose=function(f){return l(this,f,"jqmHide")};d.fn.jqmAddTrigger=function(f){return l(this,f,"jqmShow")};d.fn.jqmShow=function(e){return this.each(function(){d.jqm.open(this._jqm,e)})};d.fn.jqmHide=function(e){return this.each(function(){d.jqm.close(this._jqm,e)})};d.jqm={hash:{},open:function(B,A){var m=n[B],q=m.c,i="."+q.closeClass,v=(parseInt(m.w.css("z-index"))),v=(v>0)?v:3000,f=d("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":v-1,opacity:q.overlay/100});if(m.a){return o}m.t=A;m.a=true;m.w.css("z-index",v);if(q.modal){if(!a[0]){k("bind")}a.push(B)}else{if(q.overlay>0){m.w.jqmAddClose(f)}else{f=o}}m.o=(f)?f.addClass(q.overlayClass).prependTo("body"):o;if(c){d("html,body").css({height:"100%",width:"100%"});if(f){f=f.css({position:"absolute"})[0];for(var w in {Top:1,Left:1}){f.style.setExpression(w.toLowerCase(),"(_=(document.documentElement.scroll"+w+" || document.body.scroll"+w+"))+'px'")}}}if(q.ajax){var e=q.target||m.w,x=q.ajax,e=(typeof e=="string")?d(e,m.w):d(e),x=(x.substr(0,1)=="@")?d(A).attr(x.substring(1)):x;e.html(q.ajaxText).load(x,function(){if(q.onLoad){q.onLoad.call(this,m)}if(i){m.w.jqmAddClose(d(i,m.w))}j(m)})}else{if(i){m.w.jqmAddClose(d(i,m.w))}}if(q.toTop&&m.o){m.w.before('<span id="jqmP'+m.w[0]._jqm+'"></span>').insertAfter(m.o)}(q.onShow)?q.onShow(m):m.w.show();j(m);return o},close:function(f){var e=n[f];if(!e.a){return o}e.a=o;if(a[0]){a.pop();if(!a[0]){k("unbind")}}if(e.c.toTop&&e.o){d("#jqmP"+e.w[0]._jqm).after(e.w).remove()}if(e.c.onHide){e.c.onHide(e)}else{e.w.hide();if(e.o){e.o.remove()}}return o},params:{}};var p=0,n=d.jqm.hash,a=[],c=d.browser.msie&&(d.browser.version=="6.0"),o=false,g=d('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),j=function(e){if(c){if(e.o){e.o.html('<p style="width:100%;height:100%"/>').prepend(g)}else{if(!d("iframe.jqm",e.w)[0]){e.w.prepend(g)}}}h(e)},h=function(f){try{d(":input:visible",f.w)[0].focus()}catch(e){}},k=function(e){d()[e]("keypress",b)[e]("keydown",b)[e]("mousedown",b)},b=function(m){var f=n[a[a.length-1]],i=(!d(m.target).parents(".jqmID"+f.s)[0]);if(i){h(f)}return !i},l=function(e,f,i){return e.each(function(){var m=this._jqm;d(f).each(function(){if(!this[i]){this[i]=[];d(this).click(function(){for(var q in {jqmShow:1,jqmHide:1}){for(var r in this[q]){if(n[this[q][r]]){n[this[q][r]].w[q](this)}}}return o})}this[i].push(m)})})}})(jQuery);(function(e){e.fn.jqDrag=function(f){return b(this,f,"d")};e.fn.jqResize=function(f){return b(this,f,"r")};e.jqDnR={dnr:{},e:0,drag:function(f){if(g.k=="d"){d.css({left:g.X+f.pageX-g.pX,top:g.Y+f.pageY-g.pY})}else{d.css({width:Math.max(f.pageX-g.pX+g.W,0),height:Math.max(f.pageY-g.pY+g.H,0)})}return false},stop:function(){e().unbind("mousemove",a.drag).unbind("mouseup",a.stop)}};var a=e.jqDnR,g=a.dnr,d=a.e,b=function(j,i,f){return j.each(function(){i=(i)?e(i,j):j;i.bind("mousedown",{e:j,k:f},function(h){var m=h.data,l={};d=m.e;if(d.css("position")!="relative"){try{d.position(l)}catch(k){}}g={X:l.left||c("left")||0,Y:l.top||c("top")||0,W:c("width")||d[0].scrollWidth||0,H:c("height")||d[0].scrollHeight||0,pX:h.pageX,pY:h.pageY,k:m.k};e().mousemove(e.jqDnR.drag).mouseup(e.jqDnR.stop);return false})})},c=function(f){return parseInt(d.css(f))||false}})(jQuery);(function(a){a.fn.extend({addSubGridCell:function(e,c){var b="",d;this.each(function(){b=this.formatCol(e,c);d=this.p.gridview});if(d===false){return"<td role='grid' class='ui-sgcollapsed sgcollapsed' "+b+"><a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a></td>"}else{return"<td role='grid' "+b+"></td>"}},addSubGrid:function(b,c){return this.each(function(){var l=this;if(!l.grid){return}var m,n,o,i,j,g,h;a("td:eq("+c+")",b).click(function(p){if(a(this).hasClass("sgcollapsed")){o=l.p.id;m=a(this).parent();i=c==1?"<td></td>":"";n=a(m).attr("id");h=true;if(a.isFunction(l.p.subGridBeforeExpand)){h=l.p.subGridBeforeExpand(o+"_"+n,n)}if(h===false){return false}j=0;a.each(l.p.colModel,function(r,q){if(this.hidden===true){j++}});g="<tr role='row' class='ui-subgrid'>"+i+"<td><span class='ui-icon ui-icon-carat-1-sw'/></td><td colspan='"+parseInt(l.p.colNames.length-1-j)+"' class='ui-widget-content subgrid-data'><div id="+o+"_"+n+" class='tablediv'>";a(this).parent().after(g+"</div></td></tr>");if(a.isFunction(l.p.subGridRowExpanded)){l.p.subGridRowExpanded(o+"_"+n,n)}else{k(m)}a(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-minus'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded")}else{if(a(this).hasClass("sgexpanded")){h=true;if(a.isFunction(l.p.subGridRowColapsed)){m=a(this).parent();n=a(m).attr("id");h=l.p.subGridRowColapsed(o+"_"+n,n)}if(h===false){return false}a(this).parent().next().remove(".ui-subgrid");a(this).html("<a href='javascript:void(0);'><span class='ui-icon ui-icon-plus'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed")}}return false});var k=function(t){var s,p,u,r,q;p=a(t).attr("id");u={id:p,nd_:(new Date().getTime())};if(!l.p.subGridModel[0]){return false}if(l.p.subGridModel[0].params){for(q=0;q<l.p.subGridModel[0].params.length;q++){for(r=0;r<l.p.colModel.length;r++){if(l.p.colModel[r].name==l.p.subGridModel[0].params[q]){u[l.p.colModel[r].name]=a("td:eq("+r+")",t).text().replace(/\&nbsp\;/ig,"")}}}}if(!l.grid.hDiv.loading){l.grid.hDiv.loading=true;a("#load_"+l.p.id).show();if(!l.p.subgridtype){l.p.subgridtype=l.p.datatype}if(a.isFunction(l.p.subgridtype)){l.p.subgridtype(u)}switch(l.p.subgridtype){case"xml":a.ajax({type:l.p.mtype,url:l.p.subGridUrl,dataType:"xml",data:u,complete:function(v){d(v.responseXML,p);v=null}});break;case"json":a.ajax({type:l.p.mtype,url:l.p.subGridUrl,dataType:"text",data:u,complete:function(v){f(a.parse(v.responseText),p);v=null}});break}}return false};var e=function(q,p,s){var r=a("<td align='"+l.p.subGridModel[0].align[s]+"'></td>").html(p);a(q).append(r)};var d=function(u,s){var w,t,v,p,r=a("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),q=a("<tr></tr>");for(t=0;t<l.p.subGridModel[0].name.length;t++){w=a("<th class='ui-state-default ui-th-column'></th>");a(w).html(l.p.subGridModel[0].name[t]);a(w).width(l.p.subGridModel[0].width[t]);a(q).append(w)}a(r).append(q);if(u){p=l.p.xmlReader.subgrid;a(p.root+" "+p.row,u).each(function(){q=a("<tr class='ui-widget-content ui-subtblcell'></tr>");if(p.repeatitems===true){a(p.cell,this).each(function(z){e(q,a(this).text()||"&nbsp;",z)})}else{var y=l.p.subGridModel[0].mapping;if(y){for(t=0;t<y.length;t++){e(q,a(y[t],this).text()||"&nbsp;",t)}}}a(r).append(q)})}var x=a("table:first",l.grid.bDiv).attr("id")+"_";a("#"+x+s).append(r);l.grid.hDiv.loading=false;a("#load_"+l.p.id).hide();return false};var f=function(w,t){var y,A,u,x,p,r=a("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),q=a("<tr></tr>");for(u=0;u<l.p.subGridModel[0].name.length;u++){y=a("<th class='ui-state-default ui-th-column'></th>");a(y).html(l.p.subGridModel[0].name[u]);a(y).width(l.p.subGridModel[0].width[u]);a(q).append(y)}a(r).append(q);if(w){p=l.p.jsonReader.subgrid;A=w[p.root];if(typeof A!=="undefined"){for(u=0;u<A.length;u++){x=A[u];q=a("<tr class='ui-widget-content ui-subtblcell'></tr>");if(p.repeatitems===true){if(p.cell){x=x[p.cell]}for(var s=0;s<x.length;s++){e(q,x[s]||"&nbsp;",s)}}else{var v=l.p.subGridModel[0].mapping;if(v.length){for(var s=0;s<v.length;s++){e(q,x[v[s]]||"&nbsp;",s)}}}a(r).append(q)}}}var z=a("table:first",l.grid.bDiv).attr("id")+"_";a("#"+z+t).append(r);l.grid.hDiv.loading=false;a("#load_"+l.p.id).hide();return false};l.subGridXml=function(q,p){d(q,p)};l.subGridJson=function(q,p){f(q,p)}})},expandSubGridRow:function(b){return this.each(function(){var e=this;if(!e.grid&&!b){return}if(e.p.subGrid===true){var c=a(this).getInd(e.rows,b,true);if(c){var d=a("td.sgcollapsed",c)[0];if(d){a(d).trigger("click")}}}})},collapseSubGridRow:function(b){return this.each(function(){var e=this;if(!e.grid&&!b){return}if(e.p.subGrid===true){var c=a(this).getInd(e.rows,b,true);if(c){var d=a("td.sgexpanded",c)[0];if(d){a(d).trigger("click")}}}})},toggleSubGridRow:function(b){return this.each(function(){var e=this;if(!e.grid&&!b){return}if(e.p.subGrid===true){var c=a(this).getInd(e.rows,b,true);if(c){var d=a("td.sgcollapsed",c)[0];if(d){a(d).trigger("click")}else{d=a("td.sgexpanded",c)[0];if(d){a(d).trigger("click")}}}}})}})})(jQuery);(function(a){a.fn.extend({setTreeNode:function(b,c){return this.each(function(){var k=this;if(!k.grid||!k.p.treeGrid){return}var n=0,l=0;if(!k.p.expColInd){for(var q in k.p.colModel){if(k.p.colModel[q].name==k.p.ExpandColumn){n=l;k.p.expColInd=n;break}l++}if(!k.p.expColInd){k.p.expColInd=n}}else{n=k.p.expColInd}var m=k.p.treeReader.expanded_field;var g=k.p.treeReader.leaf_field;var f=k.p.treeReader.level_field;c.level=b[f];if(k.p.treeGridModel=="nested"){c.lft=b[k.p.treeReader.left_field];c.rgt=b[k.p.treeReader.right_field];if(!b[g]){b[g]=(parseInt(c.rgt,10)===parseInt(c.lft,10)+1)?"true":"false"}}else{c.parent_id=b[k.p.treeReader.parent_id_field]}var o=parseInt(c.level,10),j,p;if(k.p.tree_root_level===0){j=o+1;p=o}else{j=o;p=o-1}var d=document.createElement("div");a(d).addClass("tree-wrap").width(j*18);var h=document.createElement("div");a(h).css("left",p*18).addClass("ui-icon");d.appendChild(h);if(b[g]=="true"){a(h).addClass(k.p.treeIcons.leaf+" tree-leaf");c.isLeaf=true}else{if(b[m]=="true"){a(h).addClass(k.p.treeIcons.minus+" tree-minus treeclick");c.expanded=true}else{a(h).addClass(k.p.treeIcons.plus+" tree-plus treeclick");c.expanded=false}c.isLeaf=false}if(parseInt(b[f],10)!==parseInt(k.p.tree_root_level,10)){if(!a(k).isVisibleNode(c)){a(c).css("display","none")}}var e=a("td:eq("+n+")",c).html();var r=a("td:eq("+n+")",c).html("<span>"+e+"</span>").prepend(d);a(".treeclick",r).click(function(t){var s=t.target||t.srcElement;var i=a(s,k.rows).parents("tr:first")[0].rowIndex;if(!k.rows[i].isLeaf){if(k.rows[i].expanded){a(k).collapseRow(k.rows[i]);a(k).collapseNode(k.rows[i])}else{a(k).expandRow(k.rows[i]);a(k).expandNode(k.rows[i])}}return false});if(k.p.ExpandColClick===true){a("span",r).css("cursor","pointer").click(function(t){var s=t.target||t.srcElement;var i=a(s,k.rows).parents("tr:first")[0].rowIndex;if(!k.rows[i].isLeaf){if(k.rows[i].expanded){a(k).collapseRow(k.rows[i]);a(k).collapseNode(k.rows[i])}else{a(k).expandRow(k.rows[i]);a(k).expandNode(k.rows[i])}}a(k).setSelection(k.rows[i].id);return false})}})},setTreeGrid:function(){return this.each(function(){var b=this;if(!b.p.treeGrid){return}a.extend(b.p,{treedatatype:null});b.p.treeIcons=a.extend({plus:"ui-icon-triangle-1-e",minus:"ui-icon-triangle-1-s",leaf:"ui-icon-radio-off"},b.p.treeIcons||{});if(b.p.treeGridModel=="nested"){b.p.treeReader=a.extend({level_field:"level",left_field:"lft",right_field:"rgt",leaf_field:"isLeaf",expanded_field:"expanded"},b.p.treeReader)}else{if(b.p.treeGridModel=="adjacency"){b.p.treeReader=a.extend({level_field:"level",parent_id_field:"parent",leaf_field:"isLeaf",expanded_field:"expanded"},b.p.treeReader)}}})},expandRow:function(b){this.each(function(){var d=this;if(!d.grid||!d.p.treeGrid){return}var c=a(d).getNodeChildren(b);a(c).each(function(e){a(this).css("display","");if(this.expanded){a(d).expandRow(this)}})})},collapseRow:function(b){this.each(function(){var d=this;if(!d.grid||!d.p.treeGrid){return}var c=a(d).getNodeChildren(b);a(c).each(function(e){a(this).css("display","none");a(d).collapseRow(this)})})},getRootNodes:function(){var b=[];this.each(function(){var d=this;if(!d.grid||!d.p.treeGrid){return}switch(d.p.treeGridModel){case"nested":var c=d.p.treeReader.level_field;a(d.rows).each(function(e){if(parseInt(this[c],10)===parseInt(d.p.tree_root_level,10)){b.push(this)}});break;case"adjacency":a(d.rows).each(function(e){if(this.parent_id.toLowerCase()=="null"){b.push(this)}});break}});return b},getNodeDepth:function(c){var b=null;this.each(function(){var d=this;if(!this.grid||!this.p.treeGrid){return}switch(d.p.treeGridModel){case"nested":b=parseInt(c.level,10)-parseInt(this.p.tree_root_level,10);break;case"adjacency":b=a(d).getNodeAncestors(c).length;break}});return b},getNodeParent:function(c){var b=null;this.each(function(){var g=this;if(!g.grid||!g.p.treeGrid){return}switch(g.p.treeGridModel){case"nested":var e=parseInt(c.lft,10),d=parseInt(c.rgt,10),f=parseInt(c.level,10);a(this.rows).each(function(){if(parseInt(this.level,10)===f-1&&parseInt(this.lft)<e&&parseInt(this.rgt)>d){b=this;return false}});break;case"adjacency":a(this.rows).each(function(){if(this.id===c.parent_id){b=this;return false}});break}});return b},getNodeChildren:function(c){var b=[];this.each(function(){var g=this;if(!g.grid||!g.p.treeGrid){return}switch(g.p.treeGridModel){case"nested":var e=parseInt(c.lft,10),d=parseInt(c.rgt,10),f=parseInt(c.level,10);a(this.rows).slice(1).each(function(h){if(parseInt(this.level,10)===f+1&&parseInt(this.lft,10)>e&&parseInt(this.rgt,10)<d){b.push(this)}});break;case"adjacency":a(this.rows).slice(1).each(function(h){if(this.parent_id==c.id){b.push(this)}});break}});return b},getFullTreeNode:function(c){var b=[];this.each(function(){var g=this;if(!g.grid||!g.p.treeGrid){return}switch(g.p.treeGridModel){case"nested":var e=parseInt(c.lft,10),d=parseInt(c.rgt,10),f=parseInt(c.level,10);a(this.rows).each(function(h){if(parseInt(this.level,10)>=f&&parseInt(this.lft,10)>=e&&parseInt(this.lft,10)<=d){b.push(this)}});break;case"adjacency":break}});return b},getNodeAncestors:function(c){var b=[];this.each(function(){if(!this.grid||!this.p.treeGrid){return}var d=a(this).getNodeParent(c);while(d){b.push(d);d=a(this).getNodeParent(d)}});return b},isVisibleNode:function(c){var b=true;this.each(function(){var e=this;if(!e.grid||!e.p.treeGrid){return}var d=a(e).getNodeAncestors(c);a(d).each(function(){b=b&&this.expanded;if(!b){return false}})});return b},isNodeLoaded:function(c){var b;this.each(function(){var d=this;if(!d.grid||!d.p.treeGrid){return}if(c.loaded!==undefined){b=c.loaded}else{if(c.isLeaf||a(d).getNodeChildren(c).length>0){b=true}else{b=false}}});return b},expandNode:function(b){return this.each(function(){if(!this.grid||!this.p.treeGrid){return}if(!b.expanded){if(a(this).isNodeLoaded(b)){b.expanded=true;a("div.treeclick",b).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus")}else{b.expanded=true;a("div.treeclick",b).removeClass(this.p.treeIcons.plus+" tree-plus").addClass(this.p.treeIcons.minus+" tree-minus");this.p.treeANode=b.rowIndex;this.p.datatype=this.p.treedatatype;if(this.p.treeGridModel=="nested"){a(this).setGridParam({postData:{nodeid:b.id,n_left:b.lft,n_right:b.rgt,n_level:b.level}})}else{a(this).setGridParam({postData:{nodeid:b.id,parentid:b.parent_id,n_level:b.level}})}a(this).trigger("reloadGrid");if(this.p.treeGridModel=="nested"){a(this).setGridParam({postData:{nodeid:"",n_left:"",n_right:"",n_level:""}})}else{a(this).setGridParam({postData:{nodeid:"",parentid:"",n_level:""}})}}}})},collapseNode:function(b){return this.each(function(){if(!this.grid||!this.p.treeGrid){return}if(b.expanded){b.expanded=false;a("div.treeclick",b).removeClass(this.p.treeIcons.minus+" tree-minus").addClass(this.p.treeIcons.plus+" tree-plus")}})},SortTree:function(b){return this.each(function(){if(!this.grid||!this.p.treeGrid){return}var f,c,g,e=[],h=this,d=a(this).getRootNodes();d.sort(function(j,i){if(j.sortKey<i.sortKey){return -b}if(j.sortKey>i.sortKey){return b}return 0});if(d[0]){a("td",d[0]).each(function(i){a(this).css("width",h.grid.headers[i].width+"px")});h.grid.cols=d[0].cells}for(f=0,c=d.length;f<c;f++){g=d[f];e.push(g);a(this).collectChildrenSortTree(e,g,b)}a.each(e,function(i,j){a("tbody",h.grid.bDiv).append(j);j.sortKey=null})})},collectChildrenSortTree:function(b,d,c){return this.each(function(){if(!this.grid||!this.p.treeGrid){return}var g,e,h,f=a(this).getNodeChildren(d);f.sort(function(j,i){if(j.sortKey<i.sortKey){return -c}if(j.sortKey>i.sortKey){return c}return 0});for(g=0,e=f.length;g<e;g++){h=f[g];b.push(h);a(this).collectChildrenSortTree(b,h,c)}})},setTreeRow:function(c,d){var b,e=false;this.each(function(){var f=this;if(!f.grid||!f.p.treeGrid){return}e=a(f).setRowData(c,d)});return e},delTreeNode:function(b){return this.each(function(){var f=this;if(!f.grid||!f.p.treeGrid){return}var d=a(f).getInd(f.rows,b,true);if(d){var e=a(f).getNodeChildren(d);if(e.length>0){for(var c=0;c<e.length;c++){a(f).delRowData(e[c].id)}}a(f).delRowData(d.id)}})}})})(jQuery);(function(a){a.fn.extend({jqGridImport:function(b){b=a.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"}},b||{});return this.each(function(){var f=this;var d=function(h,m){var g=a(m.xmlGrid.config,h)[0];var l=a(m.xmlGrid.data,h)[0];if(xmlJsonClass.xml2json&&a.parse){var n=xmlJsonClass.xml2json(g," ");var n=a.parse(n);for(var i in n){var j=n[i]}if(l){var k=n.grid.datatype;n.grid.datatype="xmlstring";n.grid.datastr=h;a(f).jqGrid(j).setGridParam({datatype:k})}else{a(f).jqGrid(j)}n=null;j=null}else{alert("xml2json or parse are not present")}};var e=function(h,k){if(h&&typeof h=="string"){var g=a.parse(h);var l=g[k.jsonGrid.config];var i=g[k.jsonGrid.data];if(i){var j=l.datatype;l.datatype="jsonstring";l.datastr=i;a(f).jqGrid(l).setGridParam({datatype:j})}else{a(f).jqGrid(l)}}};switch(b.imptype){case"xml":a.ajax({url:b.impurl,type:b.mtype,data:b.impData,dataType:"xml",complete:function(g,h){if(h=="success"){d(g.responseXML,b);if(a.isFunction(b.importComplete)){b.importComplete()}}g=null}});break;case"xmlstring":if(b.impstring&&typeof b.impstring=="string"){var c=a.stringToDoc(b.impstring);if(c){d(c,b);if(a.isFunction(b.importComplete)){b.importComplete()}b.impstring=null}c=null}break;case"json":a.ajax({url:b.impurl,type:b.mtype,data:b.impData,dataType:"text",complete:function(g,h){if(h=="success"){e(g.responseText,b);if(a.isFunction(b.importComplete)){b.importComplete()}}g=null}});break;case"jsonstring":if(b.impstring&&typeof b.impstring=="string"){e(b.impstring,b);if(a.isFunction(b.importComplete)){b.importComplete()}b.impstring=null}break}})},jqGridExport:function(c){c=a.extend({exptype:"xmlstring"},c||{});var b=null;this.each(function(){if(!this.grid){return}var d=a(this).getGridParam();switch(c.exptype){case"xmlstring":b=xmlJsonClass.json2xml(d," ");break;case"jsonstring":b=JSON.stringify(d);break}});return b}})})(jQuery);var JSON={stringify:function stringify(a){var g,e,b,f="",d;switch(typeof a){case"object":if(a){if(a.constructor==Array){for(e=0;e<a.length;++e){d=stringify(a[e]);if(f){f+=","}f+=d}return"["+f+"]"}else{if(typeof a.toString!="undefined"){for(e in a){d=stringify(a[e]);if(typeof d!="function"){if(f){f+=","}f+=stringify(e)+":"+d}}return"{"+f+"}"}}}return"null";case"number":return isFinite(a)?String(a):"null";case"string":b=a.length;f='"';for(e=0;e<b;e+=1){g=a.charAt(e);if(g>=" "){if(g=="\\"||g=='"'){f+="\\"}f+=g}else{switch(g){case"\b":f+="\\b";break;case"\f":f+="\\f";break;case"\n":f+="\\n";break;case"\r":f+="\\r";break;case"\t":f+="\\t";break;default:g=g.charCodeAt();f+="\\u00"+Math.floor(g/16).toString(16)+(g%16).toString(16)}}}return f+'"';case"boolean":return String(a);case"function":return a.toString();default:return"null"}}};var xmlJsonClass={xml2json:function(b,d){if(b.nodeType===9){b=b.documentElement}var a=this.removeWhite(b);var e=this.toObj(a);var c=this.toJson(e,b.nodeName,"\t");return"{\n"+d+(d?c.replace(/\t/g,d):c.replace(/\t|\n/g,""))+"\n}"},json2xml:function(d,c){var e=function(q,f,h){var o="";var l,g;if(q instanceof Array){if(q.length===0){o+=h+"<"+f+">__EMPTY_ARRAY_</"+f+">\n"}else{for(l=0,g=q.length;l<g;l+=1){var p=h+e(q[l],f,h+"\t")+"\n";o+=p}}}else{if(typeof(q)==="object"){var k=false;o+=h+"<"+f;var j;for(j in q){if(q.hasOwnProperty(j)){if(j.charAt(0)==="@"){o+=" "+j.substr(1)+'="'+q[j].toString()+'"'}else{k=true}}}o+=k?">":"/>";if(k){for(j in q){if(q.hasOwnProperty(j)){if(j==="#text"){o+=q[j]}else{if(j==="#cdata"){o+="<![CDATA["+q[j]+"]]>"}else{if(j.charAt(0)!=="@"){o+=e(q[j],j,h+"\t")}}}}}o+=(o.charAt(o.length-1)==="\n"?h:"")+"</"+f+">"}}else{if(typeof(q)==="function"){o+=h+"<"+f+"><![CDATA["+q+"]]></"+f+">"}else{if(q.toString()==='""'||q.toString().length===0){o+=h+"<"+f+">__EMPTY_STRING_</"+f+">"}else{o+=h+"<"+f+">"+q.toString()+"</"+f+">"}}}}return o};var b="";var a;for(a in d){if(d.hasOwnProperty(a)){b+=e(d[a],a,"")}}return c?b.replace(/\t/g,c):b.replace(/\t|\n/g,"")},toObj:function(b){var g={};var f=/function/i;if(b.nodeType===1){if(b.attributes.length){var e;for(e=0;e<b.attributes.length;e+=1){g["@"+b.attributes[e].nodeName]=(b.attributes[e].nodeValue||"").toString()}}if(b.firstChild){var a=0,d=0,c=false;var h;for(h=b.firstChild;h;h=h.nextSibling){if(h.nodeType===1){c=true}else{if(h.nodeType===3&&h.nodeValue.match(/[^ \f\n\r\t\v]/)){a+=1}else{if(h.nodeType===4){d+=1}}}}if(c){if(a<2&&d<2){this.removeWhite(b);for(h=b.firstChild;h;h=h.nextSibling){if(h.nodeType===3){g["#text"]=this.escape(h.nodeValue)}else{if(h.nodeType===4){if(f.test(h.nodeValue)){g[h.nodeName]=[g[h.nodeName],h.nodeValue]}else{g["#cdata"]=this.escape(h.nodeValue)}}else{if(g[h.nodeName]){if(g[h.nodeName] instanceof Array){g[h.nodeName][g[h.nodeName].length]=this.toObj(h)}else{g[h.nodeName]=[g[h.nodeName],this.toObj(h)]}}else{g[h.nodeName]=this.toObj(h)}}}}}else{if(!b.attributes.length){g=this.escape(this.innerXml(b))}else{g["#text"]=this.escape(this.innerXml(b))}}}else{if(a){if(!b.attributes.length){g=this.escape(this.innerXml(b));if(g==="__EMPTY_ARRAY_"){g="[]"}else{if(g==="__EMPTY_STRING_"){g=""}}}else{g["#text"]=this.escape(this.innerXml(b))}}else{if(d){if(d>1){g=this.escape(this.innerXml(b))}else{for(h=b.firstChild;h;h=h.nextSibling){if(f.test(b.firstChild.nodeValue)){g=b.firstChild.nodeValue;break}else{g["#cdata"]=this.escape(h.nodeValue)}}}}}}}if(!b.attributes.length&&!b.firstChild){g=null}}else{if(b.nodeType===9){g=this.toObj(b.documentElement)}else{alert("unhandled node type: "+b.nodeType)}}return g},toJson:function(b,a,d){var j=a?('"'+a+'"'):"";if(b==="[]"){j+=(a?":[]":"[]")}else{if(b instanceof Array){var c,f;for(f=0,c=b.length;f<c;f+=1){b[f]=this.toJson(b[f],"",d+"\t")}j+=(a?":[":"[")+(b.length>1?("\n"+d+"\t"+b.join(",\n"+d+"\t")+"\n"+d):b.join(""))+"]"}else{if(b===null){j+=(a&&":")+"null"}else{if(typeof(b)==="object"){var g=[];var e;for(e in b){if(b.hasOwnProperty(e)){g[g.length]=this.toJson(b[e],e,d+"\t")}}j+=(a?":{":"{")+(g.length>1?("\n"+d+"\t"+g.join(",\n"+d+"\t")+"\n"+d):g.join(""))+"}"}else{if(typeof(b)==="string"){var h=/(^-?\d+\.?\d*$)/;var k=/function/i;b=b.toString();if(h.test(b)||k.test(b)||b==="false"||b==="true"){j+=(a&&":")+b}else{j+=(a&&":")+'"'+b+'"'}}else{j+=(a&&":")+b.toString()}}}}}return j},innerXml:function(d){var b="";if("innerHTML" in d){b=d.innerHTML}else{var a=function(j){var g="",f;if(j.nodeType===1){g+="<"+j.nodeName;for(f=0;f<j.attributes.length;f+=1){g+=" "+j.attributes[f].nodeName+'="'+(j.attributes[f].nodeValue||"").toString()+'"'}if(j.firstChild){g+=">";for(var h=j.firstChild;h;h=h.nextSibling){g+=a(h)}g+="</"+j.nodeName+">"}else{g+="/>"}}else{if(j.nodeType===3){g+=j.nodeValue}else{if(j.nodeType===4){g+="<![CDATA["+j.nodeValue+"]]>"}}}return g};for(var e=d.firstChild;e;e=e.nextSibling){b+=a(e)}}return b},escape:function(a){return a.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(b){b.normalize();var c;for(c=b.firstChild;c;){if(c.nodeType===3){if(!c.nodeValue.match(/[^ \f\n\r\t\v]/)){var a=c.nextSibling;b.removeChild(c);c=a}else{c=c.nextSibling}}else{if(c.nodeType===1){this.removeWhite(c);c=c.nextSibling}else{c=c.nextSibling}}}return b}};(function(a){a.fn.extend({setColumns:function(b){b=a.extend({top:0,left:0,width:200,height:195,modal:false,drag:true,closeicon:"ico-close.gif",beforeShowForm:null,afterShowForm:null,afterSubmitForm:null},a.jgrid.col,b||{});return this.each(function(){var j=this;if(!j.grid){return}var l=typeof b.beforeShowForm==="function"?true:false;var d=typeof b.afterShowForm==="function"?true:false;var e=typeof b.afterSubmitForm==="function"?true:false;if(!b.imgpath){b.imgpath=j.p.imgpath}var c=j.p.id;var f={themodal:"colmod"+c,modalhead:"colhd"+c,modalcontent:"colcnt"+c};var h="ColTbl_"+c;if(a("#"+f.themodal).html()!=null){if(l){b.beforeShowForm(a("#"+h))}viewModal("#"+f.themodal,{gbox:"#gbox_"+c,jqm:false});if(d){b.afterShowForm(a("#"+h))}}else{var k=a("<table id='"+h+"' class='ColTable'><tbody></tbody></table>");for(i=0;i<this.p.colNames.length;i++){if(!j.p.colModel[i].hidedlg){a(k).append("<tr><td ><input type='checkbox' id='col_"+this.p.colModel[i].name+"' class='cbox' value='T' "+((this.p.colModel[i].hidden===false)?"checked":"")+"/><label for='col_"+this.p.colModel[i].name+"'>"+this.p.colNames[i]+"("+this.p.colModel[i].name+")</label></td></tr>")}}var g="<input id='dData' type='button' value='"+b.bSubmit+"'/>";var m="<input id='eData' type='button' value='"+b.bCancel+"'/>";a(k).append("<tr><td class='ColButton'>"+g+"&nbsp;"+m+"</td></tr>");createModal(f,k,b,j.grid.hDiv,j.grid.hDiv);a("#dData","#"+h).click(function(n){for(i=0;i<j.p.colModel.length;i++){if(!j.p.colModel[i].hidedlg){if(a("#col_"+j.p.colModel[i].name).attr("checked")){a(j).showCol(j.p.colModel[i].name);a("#col_"+j.p.colModel[i].name).attr("defaultChecked",true)}else{a(j).hideCol(j.p.colModel[i].name);a("#col_"+j.p.colModel[i].name).attr("defaultChecked","")}}}hideModal("#"+f.themodal,{gb:"#gbox_"+c,jqm:false});if(e){b.afterSubmitForm(a("#"+h))}return false});a("#eData","#"+h).click(function(n){hideModal("#"+f.themodal,{gb:"#gbox_"+c,jqm:false});return false});a("#dData, #eData","#"+h).addClass("ui-state-default ui-corner-all").css({padding:".2em .5em",cursor:"pointer"}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});if(l){b.beforeShowForm(a("#"+h))}viewModal("#"+f.themodal,{gbox:"#gbox_"+c,jqm:false});if(d){b.afterShowForm(a("#"+h))}}})}})})(jQuery);(function(a){a.fn.extend({getPostData:function(){var b=this[0];if(!b.grid){return}return b.p.postData},setPostData:function(b){var c=this[0];if(!c.grid){return}if(typeof(b)==="object"){c.p.postData=b}else{alert("Error: cannot add a non-object postData value. postData unchanged.")}},appendPostData:function(b){var c=this[0];if(!c.grid){return}if(typeof(b)==="object"){a.extend(c.p.postData,b)}else{alert("Error: cannot append a non-object postData value. postData unchanged.")}},setPostDataItem:function(b,c){var d=this[0];if(!d.grid){return}d.p.postData[b]=c},getPostDataItem:function(b){var c=this[0];if(!c.grid){return}return c.p.postData[b]},removePostDataItem:function(b){var c=this[0];if(!c.grid){return}delete c.p.postData[b]},getUserData:function(){var b=this[0];if(!b.grid){return}return b.p.userData},getUserDataItem:function(b){var c=this[0];if(!c.grid){return}return c.p.userData[b]}})})(jQuery);function tableToGrid(a){$(a).each(function(){if(this.grid){return}$(this).width("99%");var m=$(this).width();var o=$("input[type=checkbox]:first",$(this));var g=$("input[type=radio]:first",$(this));var c=o.length>0;var f=!c&&g.length>0;var i=c||f;var h=o.attr("name")||g.attr("name");var k=[];var n=[];$("th",$(this)).each(function(){if(k.length==0&&i){k.push({name:"__selection__",index:"__selection__",width:0,hidden:true});n.push("__selection__")}else{k.push({name:$(this).html(),index:$(this).html(),width:$(this).width()||150});n.push($(this).html())}});var e=[];var d=[];var l=[];$("tbody > tr",$(this)).each(function(){var q={};var p=0;e.push(q);$("td",$(this)).each(function(){if(p==0&&i){var r=$("input",$(this));var s=r.attr("value");d.push(s||e.length);if(r.attr("checked")){l.push(s)}q[k[p].name]=r.attr("value")}else{q[k[p].name]=$(this).html()}p++})});$(this).empty();$(this).addClass("scroll");$(this).jqGrid({datatype:"local",width:m,colNames:n,colModel:k,multiselect:c});for(var j=0;j<e.length;j++){var b=null;if(d.length>0){b=d[j];if(b&&b.replace){b=encodeURIComponent(b).replace(/[.\-%]/g,"_")}}if(b==null){b=j+1}$(this).addRowData(b,e[j])}for(var j=0;j<l.length;j++){$(this).setSelection(l[j])}})};